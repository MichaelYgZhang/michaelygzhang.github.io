---
layout: post
title: Java Concurrency in Paractice 第一部分 基础知识
excerpt: Java Concurrency in Paractice 第二章 线程安全性 第三章 对象的共享
category: Java
---

##### 线程安全性

- 如果当多个线程访问同一个可变状态变量时没有使用合适的同步，那么程序就会出现错误，有三种方式可以修复这个问题

> - 不在线程之间共享该状态变量
> - 将状态变量修改为不可变的变量
> - 在访问状态变量时使用同步

- 当设计线程安全的类时，良好的面向对象技术、不可修改性，以及明析的不变性规范都能起到一定的帮助作用
- 编写并发应用时，正确的编程方法就是: 首先使代码正确运行，然后再提高代码的速度。
- `线程安全性`: 当多个线程访问某个类时，不管运行时环境采用何种调度方式或者这些线程将如何交替执行，并且在主调代码中不需要任何额外的同步或协同，这个类都能表现出正确的行为，那么就称这个类是线程安全的。
- 线程安全类中封装了必要的同步机制，因此客户端无须进一步采取同步措施。
- 无状态对象一定是线程安全的。
- 在实际情况中，应尽可能地使用现有的线程安全对象(比如AcomicLong)来管理类的状态，与非线程安全的对象相比，判断线程安全对象的可能状态及其状态转换情况要更为容易，从而也更容易维护和验证线程安全性。
- 要保持状态的一致性，就需要在单个原子操作中更新所有相关的状态变量。
- 锁机制: `synchronized`同步代码块包括两个部分:一个作为锁的对象引用，一个作为由这个锁保护的代码块。`内置锁是可重入的`
- 对于可能被多个线程同时访问的可变状态变量，在访问它时都需要持有同一个锁，在这种情况下，我们称状态变量是由这个锁保护的。
- 每个共享的和可变的变量都应该只由一个锁来保护，从而使维护人员知道是哪个锁。
- 对于每个包含多个变量的不变性条件，其中涉及的所有变量都需要由同一个锁来保护。
- 通常，在简单性与性能之间存在相互制约因素，当实现某个同步策略时，一定不要盲目地为了性能而牺牲简单性(这可能会破坏安全性)
- 当执行时间较长的计算或者可能无法快速完成的操作时(例如，网络I/O或者控制台I/O)一定不要持有锁

##### 对象的共享

###### 可见性

- 
