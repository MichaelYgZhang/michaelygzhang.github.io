---
layout: post
title: 亿级流量网站架构核心技术
excerpt: 亿级流量网站架构核心技术
category: Architecture
---

#### 第1部分 概述

- 交易系统设计的一些原则
  - 墨菲定律
    1. 任何事情都没有表面看起来那么简单
    2. 所有的事情都会比你预计的时间长
    3. 可能出错的事情总会出错
    4. 如果你担心某种情况发生，那么它就更有可能发生
  - 系统划分时，也需要思考康威定律
    1. 系统架构是公司组织架构的反映
    2. 应该按照业务闭环进行系统拆分／组织架构划分，实现闭环／高内聚／低耦合，减少沟通成本
    3. 如果沟通出现问题，那么应该考虑进行系统和组织架构的调整
    4. 在合适时机进行系统拆分，不要一开始就把系统／服务拆得非常细，虽然闭环，但每个人维护的系统多，维护成本高。
  - 二八定律

##### 高并发原则

- 无状态
- 拆分
  - 系统维度：按照系统功能／业务拆分，比如商品系统，购物车，结算，订单系统等
  - 功能维度：对一个系统进行功能再拆分，比如优惠券系统可以拆分为后台券创建系统，领券系统，用券系统等
  - 读写维度：根据读写比例特性进行拆分。读量大采用缓存，写量大采用分库分表。聚合读取场景，考虑数据异构拆分系统，将分散在多处的数据聚合到一起存储，提升系统的性能和可靠性。
  - AOP维度：根据访问特性，按照AOP进行拆分。
  - 模块维度：比如按照基础或者代码维护特性进行拆分，如基础模块分库分表，数据库连接池等。代码结构按照三层架构Web，Service，DAO进行划分。
- 服务化：进程内服务-》单机远程服务-》集群手动注册服务-》自动注册和发现服务-》服务的分组／隔离／路由-》服务治理如限流／黑名单
- 消息队列：大流量缓冲，数据校对
- 数据异构：数据异构，数据闭环
- 缓存银弹: 浏览器端缓存，APP客户端缓存，CDN缓存，接入层缓存，应用层缓存，分布式缓存
- 并发化

##### 高可用原则

- 降级：流量降级，业务降级
- 限流：目的防止恶意请求流量，恶意攻击，以及防止流量超出系统峰值。
- 切流量：DNS，HttpDNS，LVS／HaProxy／Nginx
- 可回滚

##### 业务设计原则

- 防重设计，重复提交表单，下单扣库存，考虑防重key，防重表。
- 幂等设计，接口幂等，异步回调
- 流程可定义
- 状态与状态机
- 后台系统操作可反馈
- 后台系统审批化
- 文档和注释
- 备份

##### 总结

[高可用脑图](https://www.processon.com/view/link/5990f37de4b0b7b347dd9f99)


#### 第2部分 高可用

##### 负载均衡与反向代理
##### 隔离术
##### 限流详解
##### 降级特级
##### 超时与重试机制
##### 回滚机制
##### 压测与预案
