---
layout: post
title: 大规模分布式存储系统原理解析与架构实战 读书笔记
excerpt: Analysis of the principle and architecture of large scale distributed storage system
category: Java
---

##### 第1章  概述

- 分布式存储概念
  0. 分布式存储的几个特性
  1. 可扩展
  2. 低成本
  3. 高性能
  4. 易用
- 分布式系统以及数据库技术
  1. 数据分布
  2. 一致性
  3. 容错
  4. 负载 均衡
  5. 事务与并发控制
  6. 易用性
  7. 压缩/解压缩
- 分布式存储分类
  1. 非结构化数据
  2. 结构化数据
  3. 半结构化数据
- 不同的分布式存储系统适合处理不同类型的数据，共分为四类分布式存储系统：分布式文件系统，分布式键值系统，分布式表格系统，分布式数据库。

###### 第一篇 基础篇

##### 第2章 单机存储系统

- 存储系统的性能主要包括两个维度：吞吐量和访问延时，磁盘和SSD的访问延时差别很大，但带宽差别不大，因此，磁盘适合大块顺序访问的存储系统，SSD适合随机访问较多或者对延时比较敏感的关键系统，二者也常常组合在一起进行混合存储，热数据（访问频繁）存储到SSD中，冷数据（访问不频繁）存储到磁盘中。
- 单机存储引擎
  1. 哈希存储引擎
  2. B树存储引擎
  3. LSM树存储引擎
- 数据模型：文件、关系、键值模型
- 事务与并发控制
  1. 为了提高读事务性能，可以采用写时复制(Copy-On-Write COW)或者多版本并发控制(Multi-Version Concurrency Control MVCC)技术避免写事务阻塞读事务。
  2. ACID
  3. SQL的隔离级别 Read Uncommitted, Read Committed, Repeatable Read, Serializable, Lost Update, Dirty Reads,Non-Repeatable Reads, Second Lost Updates problem, Phantom Reads
  4. 并发控制, 数据库锁
    - 解决死锁的思路主要有两种：1 每个事务设置一个超时时间，超时后自动回滚。2 死锁检测，检测到死锁后可以通过回滚其中某些事务来消除循环依赖。
- 故障恢复
  1. 操作日志
  2. 重做日志
  3. 优化手段
    - 成组提交
    - 检查点
- 数据压缩    
  1. 压缩算法
    - Huffman算法，找到一种前缀编码方式使得编码长度最短
    - LZ系列压缩算法，是一种动态创建字典的压缩算法，压缩工程中动态创建字典并保存在压缩信息里面。
    - BMDiff与Zippy
    - 列式存储

##### 第3章 分布式系统

- 分布式系统中有两个重要的协议，包括Paxos选举协议和两个阶段提交协议。Paxos协议用于多个节点之间达成一致，
  往往用于实现总控节点选举。两个阶段提交协议用于保证跨多个节点操作的原子性，这些操作要么全部成功，要么全部失败。
- 基本概念
  1. 异常；服务器宕机；网络异常；磁盘故障（磁盘损坏或磁盘数据错误）
  2. 超时，RPC执行结果的三种状态：成功，失败，超时。分布式系统中接口设计为“幂等”，超时时可以不断重试。
  3. 一致性，数据冗余备份时将出现这个问题。从两个角度理解一致性，第一个角度用户，或者称为客户端，即客户端读写
  操作是否符合某种特性；第二角度时存储系统，即存储系统的多个副本之间是否一致，更新的顺序是否相同等。
  一般要求存储系统能够读写一致性，会话一致性，单调读，单调写等特性。
  4. 衡量指标：性能，每秒处理读操作QPS Query Per Second，每秒写操作 TPS Transaction Per Second。
  设计系统时高吞吐量和低延迟需要做个权衡。可用性。一致性。可扩展性。
- 性能分析。
- 数据分布。两种，哈希分布如一致性哈希代表系统Amazon的Dynamo系统；另一个顺序分布，即每张表哥上的数据
  按照主键整体有序，代表系统有Google的Bigtable系统。
  1. 哈希分布，只支持随机读取操作不支持顺序扫描。
  2. 顺序分布。
  3. 负载均衡。
- 复制。  
- TODO
