<!DOCTYPE html>
<html>
  <head>
    <title>大规模分布式存储系统原理解析与架构实战 读书笔记 – Michael – Developer</title>

        <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="Analysis of the principle and architecture of large scale distributed storage system" />
    <meta property="og:description" content="Analysis of the principle and architecture of large scale distributed storage system" />
    
    <meta name="author" content="Michael" />

    
    <meta property="og:title" content="大规模分布式存储系统原理解析与架构实战 读书笔记" />
    <meta property="twitter:title" content="大规模分布式存储系统原理解析与架构实战 读书笔记" />
    

    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="alternate" type="application/rss+xml" title="Michael - Developer" href="/feed.xml" />
    <link rel="shortcut icon" href="/images/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css"/>
  </head>

  <body>

    <div class="wrapper-masthead">
      <div class="container">
        <header class="masthead clearfix">
          <a href="/" class="site-avatar"><img src="/images/favicon.ico" /></a>

          <div class="site-info">
            <h1 class="site-name"><a href="/">Michael</a></h1>
            <p class="site-description">Developer</p>
          </div>

          <nav>
            <a href="/"><i class="fa fa-home fa-2x"></i></a>
            <a href="/category"><i class="fa fa-tags fa-2x" aria-hidden="true"></i></a>
            <a href="/about"><i class="fa fa-user-secret fa-2x"></i></a>
            <a href="/blog"><i class="fa fa-university fa-2x"></i></a>
            <!-- <a href="/task"><i class="fa fa-book fa-2x" aria-hidden="true"></i></a> -->
            <a href="/feed.xml" target="_blank"><i class="fa fa-feed fa-2x"></i></a>

            <!-- 
            
              
            
              
            
              
              <a href="/" >
                Home
              </a>
              
            
              
              <a href="/blog" >
                Blog
              </a>
              
            
              
              <a href="/category" >
                Category
              </a>
              
             -->
          </nav>

          <a href="https://github.com/MichaelYgZhang" target="_blank">
            <img class="fork-me-on-github" src="/images/fork-me-on-github.png" alt="Fork me on GitHub">
          </a>
        </header>

        <div id="search-container">
          <input type="text" id="search-input" placeholder="search...">
          <ul id="results-container"></ul>
        </div>

      </div>
    </div>

    <div id="main" role="main" class="container">
      <article class="post">
  <div class="post">
    <h1 class="post-title">大规模分布式存储系统原理解析与架构实战 读书笔记</h1>
    <span class="post-date">2017-01-10</span>
    <!--  |
    
     -->
    <article>
      <h5 id="第1章--概述">第1章  概述</h5>

<ul>
  <li>分布式存储概念
    <ol>
      <li>分布式存储的几个特性</li>
      <li>可扩展</li>
      <li>低成本</li>
      <li>高性能</li>
      <li>易用</li>
    </ol>
  </li>
  <li>分布式系统以及数据库技术
    <ol>
      <li>数据分布</li>
      <li>一致性</li>
      <li>容错</li>
      <li>负载 均衡</li>
      <li>事务与并发控制</li>
      <li>易用性</li>
      <li>压缩/解压缩</li>
    </ol>
  </li>
  <li>分布式存储分类
    <ol>
      <li>非结构化数据</li>
      <li>结构化数据</li>
      <li>半结构化数据</li>
    </ol>
  </li>
  <li>不同的分布式存储系统适合处理不同类型的数据，共分为四类分布式存储系统：分布式文件系统，分布式键值系统，分布式表格系统，分布式数据库。</li>
</ul>

<h6 id="第一篇-基础篇">第一篇 基础篇</h6>

<h5 id="第2章-单机存储系统">第2章 单机存储系统</h5>

<ul>
  <li>存储系统的性能主要包括两个维度：吞吐量和访问延时，磁盘和SSD的访问延时差别很大，但带宽差别不大，因此，磁盘适合大块顺序访问的存储系统，SSD适合随机访问较多或者对延时比较敏感的关键系统，二者也常常组合在一起进行混合存储，热数据（访问频繁）存储到SSD中，冷数据（访问不频繁）存储到磁盘中。</li>
  <li>单机存储引擎
    <ol>
      <li>哈希存储引擎</li>
      <li>B树存储引擎</li>
      <li>LSM树存储引擎</li>
    </ol>
  </li>
  <li>数据模型：文件、关系、键值模型</li>
  <li>事务与并发控制
    <ol>
      <li>为了提高读事务性能，可以采用写时复制(Copy-On-Write COW)或者多版本并发控制(Multi-Version Concurrency Control MVCC)技术避免写事务阻塞读事务。</li>
      <li>ACID</li>
      <li>SQL的隔离级别 Read Uncommitted, Read Committed, Repeatable Read, Serializable, Lost Update, Dirty Reads,Non-Repeatable Reads, Second Lost Updates problem, Phantom Reads</li>
      <li>并发控制, 数据库锁
        <ul>
          <li>解决死锁的思路主要有两种：1 每个事务设置一个超时时间，超时后自动回滚。2 死锁检测，检测到死锁后可以通过回滚其中某些事务来消除循环依赖。</li>
        </ul>
      </li>
    </ol>
  </li>
  <li>故障恢复
    <ol>
      <li>操作日志</li>
      <li>重做日志</li>
      <li>优化手段
        <ul>
          <li>成组提交</li>
          <li>检查点</li>
        </ul>
      </li>
    </ol>
  </li>
  <li>数据压缩
    <ol>
      <li>压缩算法
        <ul>
          <li>Huffman算法，找到一种前缀编码方式使得编码长度最短</li>
          <li>LZ系列压缩算法，是一种动态创建字典的压缩算法，压缩工程中动态创建字典并保存在压缩信息里面。</li>
          <li>BMDiff与Zippy</li>
          <li>列式存储</li>
        </ul>
      </li>
    </ol>
  </li>
</ul>

<h5 id="第3章-分布式系统">第3章 分布式系统</h5>

<ul>
  <li>分布式系统中有两个重要的协议，包括Paxos选举协议和两个阶段提交协议。Paxos协议用于多个节点之间达成一致，
往往用于实现总控节点选举。两个阶段提交协议用于保证跨多个节点操作的原子性，这些操作要么全部成功，要么全部失败。</li>
  <li>基本概念
    <ol>
      <li>异常；服务器宕机；网络异常；磁盘故障（磁盘损坏或磁盘数据错误）</li>
      <li>超时，RPC执行结果的三种状态：成功，失败，超时。分布式系统中接口设计为“幂等”，超时时可以不断重试。</li>
      <li>一致性，数据冗余备份时将出现这个问题。从两个角度理解一致性，第一个角度用户，或者称为客户端，即客户端读写
操作是否符合某种特性；第二角度时存储系统，即存储系统的多个副本之间是否一致，更新的顺序是否相同等。
一般要求存储系统能够读写一致性，会话一致性，单调读，单调写等特性。</li>
      <li>衡量指标：性能，每秒处理读操作QPS Query Per Second，每秒写操作 TPS Transaction Per Second。
设计系统时高吞吐量和低延迟需要做个权衡。可用性。一致性。可扩展性。</li>
    </ol>
  </li>
  <li>性能分析。</li>
  <li>数据分布。两种，哈希分布如一致性哈希代表系统Amazon的Dynamo系统；另一个顺序分布，即每张表哥上的数据
按照主键整体有序，代表系统有Google的Bigtable系统。
    <ol>
      <li>哈希分布，只支持随机读取操作不支持顺序扫描。</li>
      <li>顺序分布。</li>
      <li>负载均衡。</li>
    </ol>
  </li>
  <li>复制。</li>
  <li>容错。
    <ol>
      <li>故障检测</li>
      <li>故障恢复</li>
    </ol>
  </li>
  <li>可扩展性
    <ol>
      <li>总控节点</li>
      <li>数据库扩容</li>
      <li>异构系统</li>
    </ol>
  </li>
  <li>分布式协议
    <ol>
      <li>两个阶段和Paxos协议。两个阶段保证跨多个节点操作的院子性，也就是说跨多个节点的操作要么在所有节点上全部执行成功，要么全部失败。Paxos协议用于确保多个节点对某个投票达成一致。
        <ul>
          <li>Two-phase Commit 2PC;请求阶段，提交阶段；可能面临的故障，事务参与者发生故障，给每个事务设置一个超时时间，如果某个事务参与者一直不响应，到达超时时间后整个事务失败。协调者发生故障，协调者需要将事务相关信息记录到操作日志并同步到备用协调者，假如协调者发生故障，备用协调者可以接替它完成后续工作，如果没有备用协调者，协调者又发生了永久性故障，事务参与者将无法完成事务而一直等待下去。总而言之，2PC提交协议是阻塞协议，执行过程中需要锁住其他更新，且不能容错，大多数分布式存储系统都敬而远之，放弃对分布式事务的支持。</li>
        </ul>
      </li>
      <li>Paxos协议。准备-》批准-》确认。正确性，可终止性。</li>
      <li>Paxos与2PC；Paxos协议一种用法是用它来实现全局的锁服务或者命名的配置服务。另一种用法是用它来将用户数据复制到多个数据中心。2PC协议最大的缺陷在于无法处理协调宕机问题。两者的结合起来，通过2PC保证多个数据分片上操作的原子性，通过Paxos协议实现同一个数据分片的多个副本之间的一致性，另外Paxos解决了2PC的协调者宕机问题，当2PC协调者故障时，通过Paxos协议选举出新的协调者继续提供服务。
        <ul>
          <li>跨机房部署</li>
        </ul>
      </li>
      <li>集群整体切换</li>
      <li>单个集群跨机房</li>
      <li>Paxos选主副本。</li>
    </ol>
  </li>
</ul>

<h5 id="第二篇-范型篇">第二篇 范型篇</h5>

<h6 id="第4章-分布式文件系统">第4章 分布式文件系统</h6>

<ul>
  <li>分布式文件系统的主要功能有两个：一个是存储文档、图像、视频之类的Blob类型数据；另一个作为分布式表格系统的持久化层。</li>
  <li>GFS系统节点分为三种角色：GFS Master(主控服务器)、GFS ChunkServer(CS, 数据块服务器)以及GFS客户端。</li>
  <li>GFS关键问题；
    <ol>
      <li>租约机制</li>
      <li>一致性模型</li>
      <li>追加流程</li>
      <li>容错机制</li>
    </ol>
  </li>
  <li>Master设计
    <ol>
      <li>Master内存占用</li>
      <li>负载均衡</li>
      <li>垃圾回收</li>
      <li>快照</li>
    </ol>
  </li>
  <li>Taobao File System  读多写基本一次
    <ol>
      <li>TFS设计思路：多个逻辑图片文件共享一个物理文件。</li>
      <li>NameServer：Block管理，包括创建、删除、复制、重新均衡；DataServer管理，包括心跳、DataServer加入及退出；以及管理Block与所在DataServer之间的映射关系。与GFS Master相比，TFS
NameServer最大的不同就是不需要保存文件目录树信息，也不需要维护文件与Block之间的映射关系。</li>
      <li>追加流程</li>
      <li>图片去重是一个键值存储系统。Tair。</li>
    </ol>
  </li>
  <li>Facebook Haystack</li>
  <li>内容分发网络
    <ol>
      <li>分级存储</li>
      <li>低功耗服务器定制，考虑是I/O密集型还是CPU密集型。</li>
    </ol>
  </li>
</ul>

<h6 id="第5章-分布式键值系统">第5章 分布式键值系统</h6>

<ul>
  <li>Dynamo设计时面临的问题以及解决方案</li>
</ul>

<table>
  <thead>
    <tr>
      <th style="text-align: left">问题</th>
      <th style="text-align: left">采取的技术</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">数据分布</td>
      <td style="text-align: left">改进的一致性哈希（虚拟节点）</td>
    </tr>
    <tr>
      <td style="text-align: left">复制协议</td>
      <td style="text-align: left">复制写协议</td>
    </tr>
    <tr>
      <td style="text-align: left">数据冲突处理</td>
      <td style="text-align: left">向量时钟</td>
    </tr>
    <tr>
      <td style="text-align: left">面临故障处理</td>
      <td style="text-align: left">数据回传机制</td>
    </tr>
    <tr>
      <td style="text-align: left">永久故障后的恢复</td>
      <td style="text-align: left">Merkle哈希树</td>
    </tr>
    <tr>
      <td style="text-align: left">成员资格以及错误检测</td>
      <td style="text-align: left">基于Gossip的成员资格和错误检测协议</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>容错
TODO 100p</li>
</ul>

<h6 id="第6章-分布式表格系统">第6章 分布式表格系统</h6>

<h6 id="第7章-分布式数据库">第7章 分布式数据库</h6>

    </article>
  </div>

  <div class="related">
    <h4>最新文章</h4>
    <ul class="related-posts">
      
        <li>
          <h5>
            <a href="/books/2017/08/18/%E5%86%85%E5%90%91%E8%80%85%E4%BC%98%E5%8A%BF.html">
              内向者优势
              <small>2017-08-18</small>
            </a>
          </h5>
        </li>
      
        <li>
          <h5>
            <a href="/architecture/2017/08/10/%E4%BA%BF%E7%BA%A7%E6%B5%81%E9%87%8F%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF.html">
              亿级流量网站架构核心技术
              <small>2017-08-10</small>
            </a>
          </h5>
        </li>
      
        <li>
          <h5>
            <a href="/architecture/2017/07/26/%E9%87%8D%E6%9E%84%E6%94%B9%E5%96%84%E6%97%A2%E6%9C%89%E4%BB%A3%E7%A0%81%E7%9A%84%E8%AE%BE%E8%AE%A1.html">
              重构-改善既有代码的设计
              <small>2017-07-26</small>
            </a>
          </h5>
        </li>
      
    </ul>
  </div>

  
<div class="comments">
	<div id="disqus_thread"></div>
	<script type="text/javascript">

	    var disqus_shortname = 'michaelygzhangblog';

	    (function() {
	        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	    })();

	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

</article>

    </div>

    <div class="wrapper-footer">
      <div class="container">
        <footer class="footer">
          
<a href="mailto:g.zhangyg@gmail.com"><i class="svg-icon email"></i></a>


<a href="https://github.com/MichaelYgZhang"><i class="svg-icon github"></i></a>




<a href="https://www.twitter.com/michaelygzhang"><i class="svg-icon twitter"></i></a>


<a href="https://plus.google.com/115646538142388831563"><i class="svg-icon googleplus"></i></a>

        </footer>
      </div>
    </div>

    <div id="backToTop" class="backtoTop">
    	<i class="fa fa-hand-o-up fa-2x"></i>
    </div>

    
	<!-- Google Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-84531968-1', 'auto');
		ga('send', 'pageview', {
		  'page': '/destributed/2017/01/10/distrbuted-storage-system-principle-architecture.html',
		  'title': '大规模分布式存储系统原理解析与架构实战 读书笔记'
		});
	</script>
	<!-- End Google Analytics -->


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/simple-jekyll-search/1.1.5/jekyll-search.js" type="text/javascript"></script>
    <script src="/js/blog.js" type="text/javascript"></script>

    <script type="text/javascript">
          SimpleJekyllSearch({
            searchInput: document.getElementById('search-input'),
            resultsContainer: document.getElementById('results-container'),
            json: '/search.json',
            searchResultTemplate: '<li><a href="{url}" title="{desc}">{title}</a></li>',
            noResultsText: 'No results found',
            limit: 10,
            fuzzy: false,
            exclude: ['Welcome']
          })
    </script>
  </body>
</html>
