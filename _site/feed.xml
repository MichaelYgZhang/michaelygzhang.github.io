<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom"><generator uri="http://jekyllrb.com" version="3.2.1">Jekyll</generator><link href="/feed.xml" rel="self" type="application/atom+xml" /><link href="/" rel="alternate" type="text/html" /><updated>2016-10-03T09:54:49+08:00</updated><id>/</id><title>Michael</title><subtitle>Developer</subtitle><entry><title>HTTP权威指南-9-10</title><link href="/cs/2016/10/02/HTTP%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-9-10.html" rel="alternate" type="text/html" title="HTTP权威指南-9-10" /><published>2016-10-02T00:00:00+08:00</published><updated>2016-10-02T00:00:00+08:00</updated><id>/cs/2016/10/02/HTTP权威指南-9-10</id><content type="html" xml:base="/cs/2016/10/02/HTTP%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-9-10.html">&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#web&quot; id=&quot;markdown-toc-web&quot;&gt;第九章 Web机器人&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section&quot; id=&quot;markdown-toc-section&quot;&gt;爬虫及爬行方式&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#http&quot; id=&quot;markdown-toc-http&quot;&gt;机器人的HTTP&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-1&quot; id=&quot;markdown-toc-section-1&quot;&gt;行为不当的机器人&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-2&quot; id=&quot;markdown-toc-section-2&quot;&gt;拒绝机器人访问&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-3&quot; id=&quot;markdown-toc-section-3&quot;&gt;搜索引擎&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#http-ng-&quot; id=&quot;markdown-toc-http-ng-&quot;&gt;第十章 HTTP-NG 下一代系统&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#http-1&quot; id=&quot;markdown-toc-http-1&quot;&gt;HTTP发展中存在的问题&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#modularize-and-enhance&quot; id=&quot;markdown-toc-modularize-and-enhance&quot;&gt;模块化及功能增强(modularize and enhance)&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;web&quot;&gt;第九章 Web机器人&lt;/h4&gt;
&lt;h5 id=&quot;section&quot;&gt;爬虫及爬行方式&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;从哪儿开始: 根集&lt;/li&gt;
  &lt;li&gt;链接的提取以及相对链接的标准化&lt;/li&gt;
  &lt;li&gt;避免环路出现&lt;/li&gt;
  &lt;li&gt;循环与复制
    &lt;blockquote&gt;
      &lt;p&gt;⚠️ 如果爬虫不断地获取相同的页面时，并且爬虫与服务器连接良好，它就可能会阻止其他真实用户的访问，这种拒绝服务是可以作为法律诉讼理由的。&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;面包屑留下的痕迹;大规模Web爬虫对其访问地址进行管理时使用以下相关技术点:
    &lt;ol&gt;
      &lt;li&gt;树和散列表(加速URL查找)&lt;/li&gt;
      &lt;li&gt;有损的存在位图(减小空间)&lt;/li&gt;
      &lt;li&gt;检查点(将已访问URL列表存在硬盘上，防止机器人程序崩溃)&lt;/li&gt;
      &lt;li&gt;分类&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;别名与机器人环路&lt;/li&gt;
  &lt;li&gt;规范化URL
    &lt;ol&gt;
      &lt;li&gt;如果没有指定端口的话，就向主机名中添加 ‘80’&lt;/li&gt;
      &lt;li&gt;将所有转义符 %xx 都转换成等价字符&lt;/li&gt;
      &lt;li&gt;删除 # 标签&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;文件系统连接环路 ‘/’&lt;/li&gt;
  &lt;li&gt;动态虚拟Web空间&lt;/li&gt;
  &lt;li&gt;避免循环和重复
    &lt;blockquote&gt;
      &lt;ol&gt;
        &lt;li&gt;规范化URL&lt;/li&gt;
        &lt;li&gt;广度优先的爬行&lt;/li&gt;
        &lt;li&gt;节流&lt;/li&gt;
        &lt;li&gt;限制URL的大小&lt;/li&gt;
        &lt;li&gt;URL/站点黑名单&lt;/li&gt;
        &lt;li&gt;模式检测&lt;/li&gt;
        &lt;li&gt;内容指纹&lt;/li&gt;
        &lt;li&gt;人工监视&lt;/li&gt;
      &lt;/ol&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;http&quot;&gt;机器人的HTTP&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;识别请求首部&lt;/li&gt;
  &lt;li&gt;虚拟主机，实现机器人要支持Host首部&lt;/li&gt;
  &lt;li&gt;条件请求&lt;/li&gt;
  &lt;li&gt;对响应的处理;需要识别比如状态码，实体等&lt;/li&gt;
  &lt;li&gt;User-agent导向&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;section-1&quot;&gt;行为不当的机器人&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;失控机器人&lt;/li&gt;
  &lt;li&gt;实效的URL&lt;/li&gt;
  &lt;li&gt;很长的错误URL&lt;/li&gt;
  &lt;li&gt;爱打听的机器人&lt;/li&gt;
  &lt;li&gt;动态网关访问&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;section-2&quot;&gt;拒绝机器人访问&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;拒绝机器人访问标准; Dissallow/Allow&lt;/li&gt;
  &lt;li&gt;Web站点和robots.txt文件
    &lt;blockquote&gt;
      &lt;ol&gt;
        &lt;li&gt;User-agent: &lt;robot-name&gt;&lt;/robot-name&gt;&lt;/li&gt;
        &lt;li&gt;Dissallow&lt;/li&gt;
        &lt;li&gt;Allow&lt;/li&gt;
      &lt;/ol&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;缓存和robots.txt的过期&lt;/li&gt;
  &lt;li&gt;HTML的robot-control元标签&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;section-3&quot;&gt;搜索引擎&lt;/h5&gt;

&lt;p&gt;&lt;a href=&quot;http://www.robotstxt.org&quot;&gt;Web机器人&lt;/a&gt;
&lt;a href=&quot;http://www.searchengineworld.com&quot;&gt;搜索引擎世界&lt;/a&gt;&lt;/p&gt;

&lt;h4 id=&quot;http-ng-&quot;&gt;第十章 HTTP-NG 下一代系统&lt;/h4&gt;
&lt;h5 id=&quot;http-1&quot;&gt;HTTP发展中存在的问题&lt;/h5&gt;
&lt;ol&gt;
  &lt;li&gt;复杂性&lt;/li&gt;
  &lt;li&gt;扩展性&lt;/li&gt;
  &lt;li&gt;性能&lt;/li&gt;
  &lt;li&gt;传输依赖性&lt;/li&gt;
&lt;/ol&gt;

&lt;h6 id=&quot;modularize-and-enhance&quot;&gt;模块化及功能增强(modularize and enhance)&lt;/h6&gt;</content><category term="CS" /><summary>第九章 Web机器人; 第十章 HTTP-NG</summary></entry><entry><title>HTTP权威指南-8</title><link href="/cs/2016/10/02/HTTP%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-8.html" rel="alternate" type="text/html" title="HTTP权威指南-8" /><published>2016-10-02T00:00:00+08:00</published><updated>2016-10-02T00:00:00+08:00</updated><id>/cs/2016/10/02/HTTP权威指南-8</id><content type="html" xml:base="/cs/2016/10/02/HTTP%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-8.html">&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#section&quot; id=&quot;markdown-toc-section&quot;&gt;网关&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-1&quot; id=&quot;markdown-toc-section-1&quot;&gt;资源网关&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#web&quot; id=&quot;markdown-toc-web&quot;&gt;应用程序接口和Web服务&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-2&quot; id=&quot;markdown-toc-section-2&quot;&gt;隧道&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-3&quot; id=&quot;markdown-toc-section-3&quot;&gt;中继&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;section&quot;&gt;网关&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;网关:协议转换器&lt;/li&gt;
  &lt;li&gt;客户端和服务器端网关&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;客户端协议&amp;gt;/&amp;lt;服务器端协议&amp;gt;&lt;/code&gt;;服务器端网关就是:HTTP/&lt;code class=&quot;highlighter-rouge&quot;&gt;*&lt;/code&gt;;客户端网关:&lt;code class=&quot;highlighter-rouge&quot;&gt;*&lt;/code&gt;/HTTP;&lt;/li&gt;
  &lt;li&gt;协议网关&lt;/li&gt;
  &lt;li&gt;HTTPS/HTTP服务器端安全网关&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;section-1&quot;&gt;资源网关&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;CGI(Common Getway Interface),为每个请求创建一个新进程，开销比较高，服务器负载大。&lt;/li&gt;
  &lt;li&gt;服务器扩展API&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;web&quot;&gt;应用程序接口和Web服务&lt;/h5&gt;

&lt;h5 id=&quot;section-2&quot;&gt;隧道&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;Web隧道允许用户通过HTTP连接发送非HTTP流量，这样就可以在HTTP上捎带其他协议数据了，使用Web隧道最常见的原因就是要在HTTP连接中嵌入非HTTP流量，这样，这类流量就可以穿过只允许Web流量通过的防火墙了。&lt;/li&gt;
  &lt;li&gt;使用CONNECT建立HTTP隧道&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-js highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;err&quot;&gt;请求建立一条&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SSL&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;隧道:&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;CONNECT&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;www&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;example&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;com&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;443&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;HTTP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;agent&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Mozilla&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;4.0&lt;/span&gt;

&lt;span class=&quot;err&quot;&gt;响应:&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;HTTP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Connection&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Established&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;Proxy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;agent&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Netscape&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Proxy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.1&lt;/span&gt;

&lt;span class=&quot;err&quot;&gt;与普通&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;HTTP&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;响应不同，这个响应并不需要包含&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Content&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Type&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;首部，此时连接只是对原始字节进行转接，不再是报文的承载着，所以不需要使用内容类型了。&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;数据隧道、定时及连接管理&lt;/li&gt;
  &lt;li&gt;隧道认证&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;section-3&quot;&gt;中继&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;中继(relay)是没有完全遵循HTTP规范的简单HTTP代理，中继负责处理HTTP中建立连接的部分，然后对字节进行盲转发。&lt;/li&gt;
  &lt;li&gt;简单盲中继实现中存在一个问题，就是他们无法正确处理Connection首部，所以有潜在的刮起keep-alive连接的可能。&lt;/li&gt;
&lt;/ul&gt;</content><category term="CS" /><summary>第八章 网关、隧道及中继</summary></entry><entry><title>HTTP权威指南-7</title><link href="/cs/2016/10/02/HTTP%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-7.html" rel="alternate" type="text/html" title="HTTP权威指南-7" /><published>2016-10-02T00:00:00+08:00</published><updated>2016-10-02T00:00:00+08:00</updated><id>/cs/2016/10/02/HTTP权威指南-7</id><content type="html" xml:base="/cs/2016/10/02/HTTP%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-7.html">&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#section&quot; id=&quot;markdown-toc-section&quot;&gt;缓存&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-1&quot; id=&quot;markdown-toc-section-1&quot;&gt;冗余的数据传输&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-2&quot; id=&quot;markdown-toc-section-2&quot;&gt;带宽瓶颈&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-3&quot; id=&quot;markdown-toc-section-3&quot;&gt;瞬间拥塞&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-4&quot; id=&quot;markdown-toc-section-4&quot;&gt;距离时延&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-5&quot; id=&quot;markdown-toc-section-5&quot;&gt;命中和未命中的&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-6&quot; id=&quot;markdown-toc-section-6&quot;&gt;缓存的拓扑结构&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-7&quot; id=&quot;markdown-toc-section-7&quot;&gt;缓存的处理步骤&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-8&quot; id=&quot;markdown-toc-section-8&quot;&gt;控制缓存的能力&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;section&quot;&gt;缓存&lt;/h4&gt;

&lt;p&gt;&lt;strong&gt;使用缓存的优点&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
  &lt;ol&gt;
    &lt;li&gt;减少冗余的数据传输，节省了你的网络费用&lt;/li&gt;
    &lt;li&gt;缓解了网络瓶颈的问题，不需要更多的带宽就能够更快地加载页面&lt;/li&gt;
    &lt;li&gt;降低了对原始服务器的要求，服务器可以更快地响应，避免过载的出现&lt;/li&gt;
    &lt;li&gt;降低了距离时延，因为从较远的地方加载页面会更慢一些&lt;/li&gt;
  &lt;/ol&gt;
&lt;/blockquote&gt;

&lt;h5 id=&quot;section-1&quot;&gt;冗余的数据传输&lt;/h5&gt;
&lt;p&gt;服务器多次传输同一份文档，每次传输给一个客户端，相同的字节在网络中一遍遍地传输，造成冗余，缓存可以很好解决这个问题。&lt;/p&gt;
&lt;h5 id=&quot;section-2&quot;&gt;带宽瓶颈&lt;/h5&gt;
&lt;p&gt;缓存可以缓解网络带宽瓶颈问题。&lt;/p&gt;
&lt;h5 id=&quot;section-3&quot;&gt;瞬间拥塞&lt;/h5&gt;
&lt;p&gt;缓存在破坏瞬间拥塞时显得非常重要，比如突发事件，使很多人几乎同时访问一个Web文档时，就会出现瞬间拥塞，由此造成Web服务器负载过高甚至崩溃。&lt;/p&gt;
&lt;h5 id=&quot;section-4&quot;&gt;距离时延&lt;/h5&gt;
&lt;p&gt;即便带宽不是问题，距离也可能是问题的原因，没太网络路由器都会增加因特网流量的时延，即使没有太多路由器，光速本身也会造成显著的时延。&lt;/p&gt;
&lt;h5 id=&quot;section-5&quot;&gt;命中和未命中的&lt;/h5&gt;
&lt;p&gt;可以用已有副本为某些到达缓存的请求提供服务，被称为&lt;code class=&quot;highlighter-rouge&quot;&gt;缓存命中&lt;/code&gt;，亦或请求的资源在缓存服务器上不存在，而将请求转发给原始服务器被称为&lt;code class=&quot;highlighter-rouge&quot;&gt;缓存未命中&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;再验证以保持缓存的”新鲜度”，在缓存服务器向源服务器发送请求的首部加上If-Modified-Since首部，告诉源服务器只有在缓存了对象的副本之后，又对其进行了修改的情况下，才发送此对象。
    &lt;ol&gt;
      &lt;li&gt;再验证命中(如果服务器对象未被修改，服务器想客户端发送一个小的HTTP304Not Modified响应)&lt;/li&gt;
      &lt;li&gt;再验证未命中(如果服务器对象与已缓存副本不同，则向客户端发送一条普通的，带有完整内容的HTTP 200 OK响应)&lt;/li&gt;
      &lt;li&gt;对象被删除(如果服务器对象已经被删除了，服务器回送一个404 Not Found响应，缓存也会将其副本删除)&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;命中率&lt;/li&gt;
  &lt;li&gt;字节命中率&lt;/li&gt;
  &lt;li&gt;区分命中和未命中的情况(根据Date首部，若响应日期比较早，则为缓存响应)&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;section-6&quot;&gt;缓存的拓扑结构&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;私有缓存(比如浏览器缓存)&lt;/li&gt;
  &lt;li&gt;公有代理缓存或者称为代理缓存&lt;/li&gt;
  &lt;li&gt;代理缓存的层次结构&lt;/li&gt;
  &lt;li&gt;网状缓存、内容路由以及对等缓存&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;section-7&quot;&gt;缓存的处理步骤&lt;/h5&gt;
&lt;p&gt;对一条HTTP GET报文的基本缓存处理过程包括7个步骤:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;接收－缓存从网络中读取抵达的请求报文。&lt;/li&gt;
  &lt;li&gt;解析－缓存对报文进行解析，提取出URL和各种首部。&lt;/li&gt;
  &lt;li&gt;查询－缓存查看是否本地有副本可用，如果没有，就获取一份并缓存本地&lt;/li&gt;
  &lt;li&gt;新鲜度检测－缓存查看已缓存副本是否足够新鲜，如果不是，就询问源服务器是否有任何更新。&lt;/li&gt;
  &lt;li&gt;创建响应－缓存会用新的首部和已缓存的主体来构建一条响应报文&lt;/li&gt;
  &lt;li&gt;发送－缓存通过网络将响应发回给客户端&lt;/li&gt;
  &lt;li&gt;日志－缓存可选地创建一个日志文件条目来描述这个事务&lt;/li&gt;
&lt;/ol&gt;

&lt;ul&gt;
  &lt;li&gt;文档过期设置(Cache-Control: max-age=3600&lt;code class=&quot;highlighter-rouge&quot;&gt;指定最大使用期限以秒为单位&lt;/code&gt;; Expires: Fri, 05 Jul 2002, 05:00:00 GMT&lt;code class=&quot;highlighter-rouge&quot;&gt;指定一个绝对的过期日期&lt;/code&gt;)&lt;/li&gt;
  &lt;li&gt;服务器再验证&lt;/li&gt;
  &lt;li&gt;在请求报文中添加用条件方法进行再验证
    &lt;blockquote&gt;
      &lt;ol&gt;
        &lt;li&gt;If-Modified-Since:&lt;date&gt;&lt;/date&gt;&lt;/li&gt;
        &lt;li&gt;If-None-Match:&lt;tags&gt;&lt;/tags&gt;&lt;/li&gt;
      &lt;/ol&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;section-8&quot;&gt;控制缓存的能力&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;服务器可以通过HTTP定义的几种方式来指定在文档过期之前可以将其缓存多长时间，按照优先级递减的顺序。服务器可以:
    &lt;ol&gt;
      &lt;li&gt;附加一个Cache-Control: no-store 首部到响应中去;&lt;/li&gt;
      &lt;li&gt;附加一个Cache-Control: no-cache 首部到响应中去;&lt;/li&gt;
      &lt;li&gt;附加一个Cache-Control: must-revalidate 首部到响应中去;&lt;/li&gt;
      &lt;li&gt;附加一个Cache-Control: max-age 首部到响应中去;&lt;/li&gt;
      &lt;li&gt;附加一个Expires 日期首部到响应中去;&lt;/li&gt;
      &lt;li&gt;不附加过期信息，让缓存确定自己的过期日期;&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;客户端的新鲜度限制&lt;/li&gt;
&lt;/ul&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;指令&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;目的&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Cache-Control: max-fresh = &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;s&amp;gt;&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;至少在未来&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;s&amp;gt;&lt;/code&gt;秒内文档要保持新鲜。&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Cache-Control: max-age = &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;s&amp;gt;&lt;/code&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;缓存无法返回缓存时间长于&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;s&amp;gt;&lt;/code&gt;秒的文档&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Cache-Control: no-cache&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;除非资源进行再验证，否则这个客户端不会接受已缓存的资源&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Cache-Control: no-store&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;缓存应尽快从存储器中删除文档的所有痕迹，因为其中可能会包含敏感信息&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Cache-Control: only-if-cached&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;只有当缓存中有副本存在时，客户端才会获取一份副本&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;</content><category term="CS" /><summary>第七章 缓存</summary></entry><entry><title>HTTP权威指南-12-13</title><link href="/cs/2016/10/02/HTTP%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-12-13.html" rel="alternate" type="text/html" title="HTTP权威指南-12-13" /><published>2016-10-02T00:00:00+08:00</published><updated>2016-10-02T00:00:00+08:00</updated><id>/cs/2016/10/02/HTTP权威指南-12-13</id><content type="html" xml:base="/cs/2016/10/02/HTTP%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-12-13.html">&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#section&quot; id=&quot;markdown-toc-section&quot;&gt;第十二章 基本认证机制&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-1&quot; id=&quot;markdown-toc-section-1&quot;&gt;第十三章 摘要认证&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;section&quot;&gt;第十二章 基本认证机制&lt;/h4&gt;
&lt;p&gt;认证的四个步骤:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;步骤&lt;/th&gt;
      &lt;th&gt;首部&lt;/th&gt;
      &lt;th&gt;描述&lt;/th&gt;
      &lt;th&gt;方法/状态&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;请求&lt;/td&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;第一条没有请求认证信息&lt;/td&gt;
      &lt;td&gt;GET&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;质询&lt;/td&gt;
      &lt;td&gt;WWW-Authenticate&lt;/td&gt;
      &lt;td&gt;服务器用401状态拒绝了请求，说明需要用户提供用户名和密码&lt;/td&gt;
      &lt;td&gt;401 Unauthorized&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;授权&lt;/td&gt;
      &lt;td&gt;Authorization&lt;/td&gt;
      &lt;td&gt;客户端重新发出请求，但这次会附加一个Authorization首部，用来说明认证算法、用户名和密码&lt;/td&gt;
      &lt;td&gt;GET&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;成功&lt;/td&gt;
      &lt;td&gt;Authorization-Info&lt;/td&gt;
      &lt;td&gt;如果授权证书正确，服务器会将文档返回，有些授权算法会在可选的Authorization-Info首部返回一些与授权会话相关的附加信息&lt;/td&gt;
      &lt;td&gt;200 OK&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;⚠️基本认证中不包括Authorization-Info首部&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;基本认证的安全缺陷&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;基本认证会通过网络发送用户名和密码，这些用户名和密码都是以一种很容易的解码的形式表示的。&lt;/li&gt;
  &lt;li&gt;即使密码是以更难解码的方式加密的，第三方用户仍然可以捕获被修改过的用户名和密码，并将修改过的用户名和密码一次次重放给原始服务器，以获取服务器访问授权，没有什么措施可以用来防止重放攻击。&lt;/li&gt;
  &lt;li&gt;即使将基本认证用于一些不太重要的的应用程序，一些不良习惯也会让它变得危险。比如很多用户的很多账号都是用相同的密码，若某些恶徒先获取了基本认证的密码然后尝试某些重要的在线银行网站!&lt;/li&gt;
  &lt;li&gt;基本认证没有提供任何针对代理和作为中间人的中间节点的防护措施，他们没有修改认证首部，但却修改了报文的其余部分，这样就严重地改变了事务的本质。&lt;/li&gt;
  &lt;li&gt;假冒服务器 很容易骗过基本认证。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;基本认证与加密数据传输(比如SSL)配合使用，会使基本认证变得更加安全。这是一种常用技巧。&lt;/p&gt;

&lt;h4 id=&quot;section-1&quot;&gt;第十三章 摘要认证&lt;/h4&gt;
&lt;p&gt;在基本认证的基础上添加了更多的限制条件。&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;客户端发起GET请求&lt;/li&gt;
  &lt;li&gt;服务器产生随机数WWW-Authenticate质询，服务器发送域随机数和算法&lt;/li&gt;
  &lt;li&gt;客户端从算法集中选择一个算法产生响应摘要及客户端随机数，Authorization作为向服务器的请求。&lt;/li&gt;
  &lt;li&gt;服务器对摘要进行认证，并产生下一个随机数，返回客户端Authorization-Info信息及下一个需要认证时发送的随机数&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;⚠️:摘要认证还有很多安全性相关的技巧&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.ietf.org/rfc/rfc2617.txt&quot;&gt;更多认证信息&lt;/a&gt;&lt;/p&gt;</content><category term="CS" /><summary>第十二章 基本认证机制; 第十三章 摘要认证</summary></entry><entry><title>HTTP权威指南-11</title><link href="/cs/2016/10/02/HTTP%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-11.html" rel="alternate" type="text/html" title="HTTP权威指南-11" /><published>2016-10-02T00:00:00+08:00</published><updated>2016-10-02T00:00:00+08:00</updated><id>/cs/2016/10/02/HTTP权威指南-11</id><content type="html" xml:base="/cs/2016/10/02/HTTP%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-11.html">&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#cookie&quot; id=&quot;markdown-toc-cookie&quot;&gt;第十一章 客户端识别与Cookie机制&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#http&quot; id=&quot;markdown-toc-http&quot;&gt;HTTP用户识别机制&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#http-1&quot; id=&quot;markdown-toc-http-1&quot;&gt;HTTP首部&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#cookie-1&quot; id=&quot;markdown-toc-cookie-1&quot;&gt;Cookie&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#cookie-&quot; id=&quot;markdown-toc-cookie-&quot;&gt;Cookie 与缓存&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#cookie-2&quot; id=&quot;markdown-toc-cookie-2&quot;&gt;Cookie安全性和隐私&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;cookie&quot;&gt;第十一章 客户端识别与Cookie机制&lt;/h4&gt;
&lt;h5 id=&quot;http&quot;&gt;HTTP用户识别机制&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;承载用户身份信息的HTTP首部&lt;/li&gt;
  &lt;li&gt;客户端IP地址跟踪，通过用户的IP地址对其进行识别&lt;/li&gt;
  &lt;li&gt;用户登陆，用认证方式来识别用户&lt;/li&gt;
  &lt;li&gt;胖URL一种在URL中嵌入识别信息的技术&lt;/li&gt;
&lt;/ul&gt;

&lt;h6 id=&quot;http-1&quot;&gt;HTTP首部&lt;/h6&gt;
&lt;ul&gt;
  &lt;li&gt;承载用户相关信息的HTTP首部&lt;/li&gt;
&lt;/ul&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;首部名称&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;首部类型&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;描述&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;From&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;请求&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;用户的E-mail地址&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;User-Agent&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;请求&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;用户的浏览器软件&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Referer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;请求&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;用户是这个页面上依照链接跳转过来的&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Authorization&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;请求&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;用户名和密码&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Client-IP&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;扩展(请求)&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;客户端IP&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;X-Forwarded-For&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;扩展(请求)&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;客户端IP地址&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Cookie&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;扩展(请求)&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;服务器产生的ID标签&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h6 id=&quot;cookie-1&quot;&gt;Cookie&lt;/h6&gt;
&lt;ul&gt;
  &lt;li&gt;Cookie类型:会话cookie(临时的一般关闭浏览器时删除)和持久cookie(存在硬盘中)&lt;/li&gt;
  &lt;li&gt;Cookie成分&lt;/li&gt;
&lt;/ul&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Set-Cookie属性&lt;/th&gt;
      &lt;th&gt;描述及实例&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;NAME = VALUE&lt;/td&gt;
      &lt;td&gt;强制的,都是字符序列，可以创建任意NAME＝VALUE关联;Set-Cookie: customer=Mary&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Expires&lt;/td&gt;
      &lt;td&gt;可选，指定一个到期日期，格式为:Weekday, DD-Mon-YY HH:MM:SS GMT&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Domain&lt;/td&gt;
      &lt;td&gt;可选,浏览器只向指定域名的服务器主机发送cookie&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Path&lt;/td&gt;
      &lt;td&gt;可选，可以为服务器上特定的文档分配cookie&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Secure&lt;/td&gt;
      &lt;td&gt;可选，只有HTTP使用了SSL安全连接时才会发送cookie;Set-Cookie: private_id =113; secure&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h6 id=&quot;cookie-&quot;&gt;Cookie 与缓存&lt;/h6&gt;
&lt;p&gt;TODO&lt;/p&gt;
&lt;h6 id=&quot;cookie-2&quot;&gt;Cookie安全性和隐私&lt;/h6&gt;

&lt;p&gt;⚠️当用户禁用cookie时，可以通过胖URL达到跟踪用户状态的目的。&lt;/p&gt;</content><category term="CS" /><summary>第十一章 客户端识别与Cookie机制</summary></entry><entry><title>HTTP权威指南-5-6</title><link href="/cs/2016/10/01/HTTP%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-5-6.html" rel="alternate" type="text/html" title="HTTP权威指南-5-6" /><published>2016-10-01T00:00:00+08:00</published><updated>2016-10-01T00:00:00+08:00</updated><id>/cs/2016/10/01/HTTP权威指南-5-6</id><content type="html" xml:base="/cs/2016/10/01/HTTP%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-5-6.html">&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#web&quot; id=&quot;markdown-toc-web&quot;&gt;第五章Web服务器&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section&quot; id=&quot;markdown-toc-section&quot;&gt;第六章代理&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#web-1&quot; id=&quot;markdown-toc-web-1&quot;&gt;Web的中间实体&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-1&quot; id=&quot;markdown-toc-section-1&quot;&gt;为什么使用代理&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-2&quot; id=&quot;markdown-toc-section-2&quot;&gt;代理去往何处&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-3&quot; id=&quot;markdown-toc-section-3&quot;&gt;客户端的代理设置&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-4&quot; id=&quot;markdown-toc-section-4&quot;&gt;与代理请求有关的一些棘手问题&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-5&quot; id=&quot;markdown-toc-section-5&quot;&gt;追踪报文&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-6&quot; id=&quot;markdown-toc-section-6&quot;&gt;代理认证&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-7&quot; id=&quot;markdown-toc-section-7&quot;&gt;代理的互操作性&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;web&quot;&gt;第五章Web服务器&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;Web服务器处理请求的响应步骤
    &lt;ol&gt;
      &lt;li&gt;建立连接－接受一个/多个客户端的连接&lt;/li&gt;
      &lt;li&gt;接收请求－从网络中读取一条HTTP请求报文&lt;/li&gt;
      &lt;li&gt;处理请求－对请求报文进行解析，并采取行动&lt;/li&gt;
      &lt;li&gt;访问资源－访问报文中指定的资源&lt;/li&gt;
      &lt;li&gt;构建响应－创建带有正确首部的HTTP响应报文&lt;/li&gt;
      &lt;li&gt;发送响应－将响应回送给客户端&lt;/li&gt;
      &lt;li&gt;记录事务的处理过程－将已完成事务有关的内容记录在一个日志文件中。&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;section&quot;&gt;第六章代理&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;Web代理(proxy)服务器是网络的中间实体，位于客户端和服务器之间扮演’中间人’的角色，在各断点之间来回传送HTTP报文。&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;web-1&quot;&gt;Web的中间实体&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;私有和共享代理&lt;/li&gt;
  &lt;li&gt;代理与网关的比较
    &lt;blockquote&gt;
      &lt;ol&gt;
        &lt;li&gt;代理:连接的是两个或多个使用&lt;code class=&quot;highlighter-rouge&quot;&gt;相同协议&lt;/code&gt;的应用程序&lt;/li&gt;
        &lt;li&gt;网关:连接的则是两个或多个使用&lt;code class=&quot;highlighter-rouge&quot;&gt;不同协议&lt;/code&gt;的端点，网关扮演&lt;code class=&quot;highlighter-rouge&quot;&gt;协议转换器&lt;/code&gt;的角色&lt;/li&gt;
      &lt;/ol&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;section-1&quot;&gt;为什么使用代理&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;网站访问过滤&lt;/li&gt;
  &lt;li&gt;文档访问权限控制&lt;/li&gt;
  &lt;li&gt;安全防火墙&lt;/li&gt;
  &lt;li&gt;Web缓存&lt;/li&gt;
  &lt;li&gt;反向代理&lt;/li&gt;
  &lt;li&gt;内容路由&lt;/li&gt;
  &lt;li&gt;转码器&lt;/li&gt;
  &lt;li&gt;匿名者&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;section-2&quot;&gt;代理去往何处&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;代理服务器的部署
    &lt;ol&gt;
      &lt;li&gt;出口代理&lt;/li&gt;
      &lt;li&gt;访问(入口)代理&lt;/li&gt;
      &lt;li&gt;反向代理(取代原始服务器的代理服务器)&lt;/li&gt;
      &lt;li&gt;网络交换代理&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;代理的层次结构(动态选择父子层次结构)
    &lt;ol&gt;
      &lt;li&gt;负载均衡&lt;/li&gt;
      &lt;li&gt;地理位置附近的路由&lt;/li&gt;
      &lt;li&gt;协议/类型路由&lt;/li&gt;
      &lt;li&gt;基于订购的路由&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;代理是如何获取流量的
    &lt;ol&gt;
      &lt;li&gt;修改Web客户端&lt;/li&gt;
      &lt;li&gt;修改网络(拦截代理)拦截代理被称为&lt;code class=&quot;highlighter-rouge&quot;&gt;透明代理&lt;/code&gt;因为你会在不知情的情况下连接到这些代理上去，但HTTP规范中已用”透明”来表示那些不会对语义进行修改的功能了，所以标准指定机构建议在流量捕获中使用术语&lt;code class=&quot;highlighter-rouge&quot;&gt;拦截&lt;/code&gt;，这里采纳了这一术语。&lt;/li&gt;
      &lt;li&gt;修改DNS命名空间&lt;/li&gt;
      &lt;li&gt;修改Web服务器&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;section-3&quot;&gt;客户端的代理设置&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;手工配置&lt;/li&gt;
  &lt;li&gt;预先配置浏览器&lt;/li&gt;
  &lt;li&gt;代理的自动配置&lt;/li&gt;
  &lt;li&gt;WPAD(Web Proxy Autodiscovery Protocol)的代理发现;⚠️目前只有IE支持这一特性&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;section-4&quot;&gt;与代理请求有关的一些棘手问题&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;代理URI与服务器URI的不同(没有设置客户端使用代理时，它会发送部分URI。设置客户端使用代理时，它会发送完整URI)&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-js highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;服务器请求&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;GET&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;html&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;HTTP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;agent&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;SuperBrowser&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;显示&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;配置了代理请求&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;GET&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//www.example.com/index.html HTTP/1.0&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;agent&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;SuperBrowser&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;替代物，反向代理&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;服务器主机名指向替代物代理&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;GET&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;html&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;HTTP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;agent&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;SuperBrowser&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;拦截代理请求&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;GET&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;html&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;HTTP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;agent&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;SuperBrowser&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;代理既可以处理代理请求，也可以处理服务器请求&lt;/li&gt;
  &lt;li&gt;转发过程中对URI的修改(HTTP规范禁止一般的拦截代理在转发URI时重写其绝对路径，唯一的例外是可以用”/”来取代空路径)&lt;/li&gt;
  &lt;li&gt;URI的客户端自动扩张和主机名解析&lt;/li&gt;
  &lt;li&gt;没有代理时URI的解析，没有提供显示的代理时，浏览器会对部分主机名进行自动扩展。&lt;/li&gt;
  &lt;li&gt;有显示代理时URI的解析，有显示设置代理时浏览器不会对不完整的主机名进行自动扩展，因此当用户在地址栏窗口中输入oreilly时，发给代理的就是http://oreilly/(浏览器添加了默认的方案和路径，但主机名和输入的一样)&lt;/li&gt;
  &lt;li&gt;有拦截代理时URI的解析&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;section-5&quot;&gt;追踪报文&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;Via首部(它列出了报文途径的每个中间节点(代理或网关)有关的信息，报文每经过一个节点，都必须将这个中间节点添加到Via列表的末尾),比如以下Via字符串告诉我们报文经过两个代理，以及分别实现的协议版本。&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Via: 1.1 proxy-62.irenes-isp.net, 1.0 cacahe.joes-hardware.com
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;响应Via通常与请求Via相反，比如请求是:’Via: 1.1 A, 1.0 B, 1.1 C’则响应是:’Via: 1.1 C, 1.0 B, 1.1 A’&lt;/li&gt;
  &lt;li&gt;Via与网关,有些代理会为使用非HTTP协议的服务器提供网关功能。Via首部会记录这些协议转换。&lt;/li&gt;
  &lt;li&gt;Via的隐私和安全问题&lt;/li&gt;
  &lt;li&gt;TRACE方法，HTTP/1.1的TRACE方法，用户可以追踪经代理链传输的请求报文，观察报文经过了哪些代理，以及每个代理是如果对请求报文进行修改的。&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-js highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nx&quot;&gt;TRACE&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;请求&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;TRACE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;html&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;HTTP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.1&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;Host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;www&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;example&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;com&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;Accept&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;html&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;TRACE&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;响应:响应首部&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Content&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Type&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;为&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;http&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;状态&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;HTTP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.1&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;OK&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;Content&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Type&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;http&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;Coontent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Length&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;269&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;Via&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.1&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;cache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;example&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;com&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.1&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;p1123&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;att&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;net&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.1&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;proxy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;irenes&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;isp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;net&lt;/span&gt;

&lt;span class=&quot;nx&quot;&gt;TRACE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;html&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;HTTP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.1&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;Host&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;www&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;example&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;com&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;Accept&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;text&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;html&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;Via&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.1&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;proxy&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;irenes&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;isp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;net&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.1&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;p1123&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;att&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;net&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;1.1&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;cache&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;example&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;com&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;可以使用Max-Forwards添加到首部限制最大转发次数&lt;/p&gt;

&lt;h5 id=&quot;section-6&quot;&gt;代理认证&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;Proxy Authorization
    &lt;h5 id=&quot;section-7&quot;&gt;代理的互操作性&lt;/h5&gt;
  &lt;/li&gt;
  &lt;li&gt;OPTIONS: 发现对可选特性的支持&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;ol&gt;
    &lt;li&gt;OPTIONS * HTTP/1.1 表示请求的整个服务器所支持的功能&lt;/li&gt;
    &lt;li&gt;OPTIONS http://www.example.com/index.html HTTP/1.1 表示具体特定资源的可用特性&lt;/li&gt;
  &lt;/ol&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
  &lt;li&gt;Allow首部，列出请求URI标识资源所支持的方法列表。也可以将Allow首部作为请求首部，建议在新建资源上支持某些方法。&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-js highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nx&quot;&gt;C&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Proxy&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;C&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;---&amp;gt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;S&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;OPTIONS&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;HTTP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.1&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;S&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;---&amp;gt;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;C&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Proxy&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;C&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;HTTP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.1&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;OK&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;Allow&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;GET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;PUT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;POST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;HEAD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;TRACE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;OPTIONS&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Proxy_server&quot;&gt;Proxy-Server wiki&lt;/a&gt;&lt;/p&gt;</content><category term="CS" /><summary>第五章-Web服务器;第六章-代理</summary></entry><entry><title>HTTP权威指南-4</title><link href="/cs/2016/09/29/HTTP%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-4.html" rel="alternate" type="text/html" title="HTTP权威指南-4" /><published>2016-09-29T00:00:00+08:00</published><updated>2016-09-29T00:00:00+08:00</updated><id>/cs/2016/09/29/HTTP权威指南-4</id><content type="html" xml:base="/cs/2016/09/29/HTTP%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-4.html">&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#tcp&quot; id=&quot;markdown-toc-tcp&quot;&gt;TCP连接&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#tcp-1&quot; id=&quot;markdown-toc-tcp-1&quot;&gt;对TCP性能的考虑&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#http&quot; id=&quot;markdown-toc-http&quot;&gt;HTTP连接的处理&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section&quot; id=&quot;markdown-toc-section&quot;&gt;并行连接&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-1&quot; id=&quot;markdown-toc-section-1&quot;&gt;持久连接&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-2&quot; id=&quot;markdown-toc-section-2&quot;&gt;管道化连接&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-3&quot; id=&quot;markdown-toc-section-3&quot;&gt;关闭连接的奥秘&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;tcp&quot;&gt;TCP连接&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;TCP的可靠数据管道&lt;/li&gt;
  &lt;li&gt;TCP流是分段的、由IP分组传送。(TCP的数据是通过名为IP分组或者IP数据报的小数据块来发送的)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;HTTP与HTTPS&lt;/strong&gt;&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;HTTP&lt;/th&gt;
      &lt;th&gt;应用层&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;TCP&lt;/td&gt;
      &lt;td&gt;传输层&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;IP&lt;/td&gt;
      &lt;td&gt;网络层&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;网络接口&lt;/td&gt;
      &lt;td&gt;数据链路层&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;HTTP&lt;/th&gt;
      &lt;th&gt;应用层&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;TSL or SSL&lt;/td&gt;
      &lt;td&gt;安全层&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;TCP&lt;/td&gt;
      &lt;td&gt;传输层&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;IP&lt;/td&gt;
      &lt;td&gt;网络层&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;网络接口层&lt;/td&gt;
      &lt;td&gt;数据链路层&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;ul&gt;
  &lt;li&gt;保持TCP连接持续不断地运行(TCP通过端口号保持所有持续运行的TCP连接)，TCP连接通过4个值来识别&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;源IP地址、源端口号、目的IP地址、目的端口号&amp;gt;&lt;/code&gt;进而一起定义唯一的一条连接。&lt;/li&gt;
  &lt;li&gt;使用TCP套接字编程&lt;/li&gt;
&lt;/ul&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;套接字API调用&lt;/th&gt;
      &lt;th&gt;描述&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;s = socket(&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;parameters&amp;gt;&lt;/code&gt;)&lt;/td&gt;
      &lt;td&gt;创建一个新的、未命名、未关联的套接字&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;bind(s,&lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;local IP:port&amp;gt;&lt;/code&gt;)&lt;/td&gt;
      &lt;td&gt;向套接字赋一个本地端口号和接口&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;connect(s, &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;remote IP:port&amp;gt;&lt;/code&gt;)&lt;/td&gt;
      &lt;td&gt;创建一条连接本地套接字与远程主机及端口的连接&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;listen(s,….)&lt;/td&gt;
      &lt;td&gt;标识一个本地套接字，使其可以合法接受连接&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;s2 = accept(s)&lt;/td&gt;
      &lt;td&gt;等待某人建立一条到本地端口的连接&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;n = read(s, buffer, n)&lt;/td&gt;
      &lt;td&gt;尝试从套接字向缓冲区读取n个字节&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;n = write(s, buffer, n)&lt;/td&gt;
      &lt;td&gt;尝试从缓冲区中向套接字写入n个字节&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;close(s)&lt;/td&gt;
      &lt;td&gt;完全关闭TCP连接&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;shutdown(s, &lt;code class=&quot;highlighter-rouge&quot;&gt;&amp;lt;side&amp;gt;&lt;/code&gt;)&lt;/td&gt;
      &lt;td&gt;只关闭TCP连接的输入或输出端&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;getsockopt(s,…)&lt;/td&gt;
      &lt;td&gt;读取某个内部套接字配置选项值&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;setsockopt(s,…)&lt;/td&gt;
      &lt;td&gt;修改某个内部套接字配置选项值&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h4 id=&quot;tcp-1&quot;&gt;对TCP性能的考虑&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;HTTP事务的时延&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;ol&gt;
    &lt;li&gt;客户端首选需要根据URL确定Web服务器的IP地址和端口号，如果最近没有对URL中的主机名进行访问，通过DNS解析系统将URL中的主机名转换成一个IP地址可能需要花费数十秒的时间&lt;/li&gt;
    &lt;li&gt;客户端会向服务器发送一条TCP连接请求，并等待服务器回送一个请求接受应答，每条新的TCP连接都会有连接时延，这个值通常最多只有一两秒钟，但如果数百个HTTP事务的话，这个值会快速地叠加上去。&lt;/li&gt;
    &lt;li&gt;一旦连接建立起来了，客户端就会通过新建立的TCP管道来发送HTTP请求，数据到达时，Web服务器会从TCP连接中读取请求报文，并对请求进行处理，网络传输请求报文以及服务器处理请求报文都需要时间。&lt;/li&gt;
    &lt;li&gt;Web服务器会会送HTTP响应，这也需要花费时间。&lt;/li&gt;
  &lt;/ol&gt;
&lt;/blockquote&gt;

&lt;p&gt;总结:这些TCP网络时延的大小取决于硬件速度，网络和服务器的负载，请求和响应报文的尺寸，以及客户端和服务器之间的距离。TCP协议技术的复杂性也会对时延产生巨大对影响。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;性能聚集区域&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;ol&gt;
    &lt;li&gt;TCP连接建立握手&lt;/li&gt;
    &lt;li&gt;TCP慢启动拥塞控制&lt;/li&gt;
    &lt;li&gt;数据聚集的Nagle算法&lt;/li&gt;
    &lt;li&gt;用于捎带确认的TCP延迟确认算法&lt;/li&gt;
    &lt;li&gt;TIME_WAIT时延和端口耗尽&lt;/li&gt;
  &lt;/ol&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
  &lt;li&gt;TCP连接的握手时延(SYN/SYN+ACK三次握手)SYN是一种标记，表明是连接请求&lt;/li&gt;
  &lt;li&gt;延迟确认&lt;/li&gt;
  &lt;li&gt;TCP慢启动‘自动调谐’&lt;/li&gt;
  &lt;li&gt;Nagle算法与TCP_NODELAY(每个TCP段至少装载40个字节的标记和首部，如果TCP发送了大量包含少量数据的分组，网络性能就会严重下降，这种行为称为”发送端傻窗口综合症”;Nagle算法就是试图在发送一个分组之前，将大量TCP数据绑定在一起，以提高效率。可以在栈中设置参数TCP_NODELAY来禁用Nagle算法，如果需要这么做一定要确保会向TCP写入大块的数据，这样就不会产生一堆小分组了)&lt;/li&gt;
  &lt;li&gt;TIME_WAIT累积与端口耗尽&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;http&quot;&gt;HTTP连接的处理&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;常被误解的Connection首部&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;ol&gt;
    &lt;li&gt;HTTP首部字段名，列出了只与此链接有关的首部&lt;/li&gt;
    &lt;li&gt;任意标签值，用于描述此连接的非标准选项&lt;/li&gt;
    &lt;li&gt;值close，说明操作完成之后需关闭这条持久连接&lt;/li&gt;
    &lt;li&gt;⚠️如果报文中包含连接相关的信息，不能将其转发出去，在转发之前，必须删除Connection首部列出的所有首部字段。进而可以防止无意中对本地首部的转发。被称为对首部的保护。&lt;/li&gt;
  &lt;/ol&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;language-js highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nx&quot;&gt;HTTP&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.1&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;OK&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;Cache&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;control&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;age&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3600&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;Connection&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;meter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;bill&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;my&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;credit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;card&lt;/span&gt;
&lt;span class=&quot;nl&quot;&gt;Meter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;users&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;refuses&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;dont&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;report&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;首部说明: 不应该转发Meter首部，要应用假象的bill-my-credit-card选项，且本次事务结束之后应关闭持久连接。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;串行事务处理时延&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;四类提高HTTP的连接性能的方法&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;并行连接(通过多条TCP连接发起并发的HTTP请求)&lt;/li&gt;
  &lt;li&gt;持久连接(重用TCP连接，以消除连接及关闭时延)&lt;/li&gt;
  &lt;li&gt;管道化连接(通过共享的TCP连接发起并发的HTTP请求)&lt;/li&gt;
  &lt;li&gt;复用的连接(交替传送请求和响应报文)&lt;/li&gt;
&lt;/ol&gt;

&lt;h4 id=&quot;section&quot;&gt;并行连接&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;并行连接可能会提高页面的加载速度&lt;/li&gt;
  &lt;li&gt;并行的连接不一定更快&lt;/li&gt;
  &lt;li&gt;并行连接可能让人“感觉”更快一些&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;section-1&quot;&gt;持久连接&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;在HTTP事务处理结束之后仍然保持在打开状态的TCP连接被称为持久连接。重用已对目标服务器打开的空闲持久连接，就可以避开缓慢的连接建立阶段，并且已经打开的连接还可以避免慢启动的拥塞适应阶段，以便更快速地进行数据的传输。&lt;/li&gt;
  &lt;li&gt;持久及并行连接，缺点:每个事务都会打开/关闭一条新的连接，会耗费时间和带宽，由于TCP慢启动特性的村子啊，每条新连接的性能都会有所降低，可打开的并行连接数量实际上是有限的。所以持久连接与并行连接配合使用是最高效的方式。&lt;/li&gt;
  &lt;li&gt;HTTP/1.0 + keep-alive连接&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Connection: Keep-Alive
Keep-Alive: max=5, timeout=120
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;响应报文表明服务器最多还会为另外5个事务保持连接的打开状态，或者将打开状态保持到连接空闲了2分钟之后。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Keep-Alive连接的限制和规则
    &lt;ol&gt;
      &lt;li&gt;HTTP/1.0中keep-alive并不是默认使用的，在需要保持持久连接的请求报文中添加请求首部Connection: Keep-Alive的请求首部来激活keep-alive本次TCP的持久连接。&lt;/li&gt;
      &lt;li&gt;TODO note page: 100&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;Keep-Alive哑代理&lt;/li&gt;
  &lt;li&gt;插入Proxy-Connection解决哑代理问题，客户端和服务器之间只有一个代理时可以使用此方式进行解决。如果是多层代理时，则仍然会出现哑代理问题。&lt;/li&gt;
  &lt;li&gt;HTTP/1.1持久连接(默认激活，HTTP1.1客户端假定在收到响应后，除非响应中包含了Connection:close首部，否则HTTP/1.1连接就仍然维持打开状态。如果需要在事务结束之后将连接关闭，HTTP/1.1必须向报文中显示地添加一个Connection:close首部，不发送Connection: close并不意味值服务器承若永远连接保持在打开状态)&lt;/li&gt;
  &lt;li&gt;持久连接的限制和规则
    &lt;ol&gt;
      &lt;li&gt;如果客户端不想在连接上发送请求了就在最后一条请求报文中发送一个Connection: close首部。&lt;/li&gt;
      &lt;li&gt;只有连接上所有的报文都是正确的、自定义报文长度时，连接才能持久保持，也就是说异常时可能会关闭。&lt;/li&gt;
      &lt;li&gt;HTTP/1.1的代理必须能够分别管理与客户端和服务器的持久连接–每个持久连接都只适用于一跳传输。&lt;/li&gt;
      &lt;li&gt;(由于较老的代理会转发Connection首部)所以HTTP/1.1的代理服务器不应该与HTTP/1.0客户端建立持久连接，会造成哑代理&lt;/li&gt;
      &lt;li&gt;HTTP/1.1要求应用程序能够从异步的关闭中恢复出来，只要不村子啊可能累积起来的副作用，客户端都应该重复这条请求。&lt;/li&gt;
      &lt;li&gt;除非重复发起请求会产生副作用，否则如果在客户端收到整条响应之前连接关闭了，客户端就必须要重新发起请求。&lt;/li&gt;
      &lt;li&gt;一个用户客户端对任何服务器或代理最多只能维护两条持久连接，以防服务器过载，代理可能需要更多到服务器的连接来支持并发用户的通信，所以，如果有N个用户试图访问服务器的话，代理最多要维持2N条到任意服务器或父代理的连接。&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;section-2&quot;&gt;管道化连接&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;HTTP/1.1允许持久连接上可选地使用请求管道，管道化:客户端在响应到达之前，可以将多条请求放入队列，当第一条请求通过网络流向地球另一端的服务器时，第二条，第三条也可以开始发送了，在高时延网络条件下，这样可以降低网络的环回时间，提高性能。&lt;/li&gt;
  &lt;li&gt;对管道化连接有几条限制
    &lt;ol&gt;
      &lt;li&gt;如果HTTP客户端无法确认连接是持久的，就不应该使用管道。&lt;/li&gt;
      &lt;li&gt;必须按照与请求相同的顺序回送HTTP响应，HTTP报文中没有序号标签，因此如果收到的响应失序了，就没有办法将其与请求匹配起来了。&lt;/li&gt;
      &lt;li&gt;HTTP客户端必须做好连接会随时关闭的准备，并准备好重发所未完成的管道化请求。&lt;/li&gt;
      &lt;li&gt;HTTP客户端不应该使用管道化的方式发送会产生副作用的请求(比如POST)。&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;section-3&quot;&gt;关闭连接的奥秘&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;所有HTTP客户端、服务器端可以在任意时刻关闭一条TCP传输连接。&lt;/li&gt;
  &lt;li&gt;管道连接必须是幂等操作如GET、HEAD、PUT、DELETE、TRACE、OPTIONS，客户端不应该使用非幂等请求如POST，否则在传输连接的过程中连接过早终止就会造成一些不确定的后果，要发送一条非幂等请求，就需要等待来自前一条请求的响应状态。&lt;/li&gt;
  &lt;li&gt;TCP连接是双向的，TCP连接的每一个端都有一个输入队列和一个输出队列对于数据的读或写，放入一端输出队列中的数据最终会出现在另一端的输入队列中。应用程序可以关闭TCP输入和输出信道中的任意一个，或者将两者都关闭了，套接字调用close()会将TCP连接的输入和输出信道都关闭调，这种方式称为”完全关闭”，可以用套接字调用shutdown()单独关闭输入或输出信道，被称为”半关闭”。
⚠️关闭连接的输入信道比较危险，因为当另一端向你关闭输入信道时，操作系统会向请求方发送一条TCP”连接被对端重置”的报文，大部分操作系统会将这种情况作为很严重的错误来处理，比如你的连接中有部分数据在缓存中还未读取，这时返回的”连接被对端重置”信息会讲你的缓冲区清空，所以慎重！关闭连接的输出信道总是安全的。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/TCP&quot;&gt;TCP-wiki&lt;/a&gt;
&lt;a href=&quot;http://www.ietf.org/rfc/rf2626.txt&quot;&gt;HTTP连接&lt;/a&gt;
&lt;a href=&quot;http://www.w3.org/Protocols/HTTP/Performance/&quot;&gt;HTTP性能问题&lt;/a&gt;&lt;/p&gt;</content><category term="CS" /><summary>第四章－连接管理</summary></entry><entry><title>HTTP权威指南-3</title><link href="/cs/2016/09/27/HTTP%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-3.html" rel="alternate" type="text/html" title="HTTP权威指南-3" /><published>2016-09-27T00:00:00+08:00</published><updated>2016-09-27T00:00:00+08:00</updated><id>/cs/2016/09/27/HTTP权威指南-3</id><content type="html" xml:base="/cs/2016/09/27/HTTP%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97-3.html">&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#section&quot; id=&quot;markdown-toc-section&quot;&gt;报文流&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-1&quot; id=&quot;markdown-toc-section-1&quot;&gt;报文的组成部分&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-2&quot; id=&quot;markdown-toc-section-2&quot;&gt;报文的语法&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-3&quot; id=&quot;markdown-toc-section-3&quot;&gt;起始行&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-4&quot; id=&quot;markdown-toc-section-4&quot;&gt;首部&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-5&quot; id=&quot;markdown-toc-section-5&quot;&gt;实体的主体部分&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-6&quot; id=&quot;markdown-toc-section-6&quot;&gt;版本0.9的报文&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-7&quot; id=&quot;markdown-toc-section-7&quot;&gt;方法&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-8&quot; id=&quot;markdown-toc-section-8&quot;&gt;状态码&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-9&quot; id=&quot;markdown-toc-section-9&quot;&gt;首部&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;section&quot;&gt;报文流&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;报文都会向下游流动，所有报文的发送者都在接收者的上游&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;section-1&quot;&gt;报文的组成部分&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;报文由三部分组成，起始行，包含属性的首部，可选的包含数据的主体&lt;/li&gt;
&lt;/ul&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;起始行&lt;/th&gt;
      &lt;th&gt;HTTP/1.0 200 OK&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;首部&lt;/td&gt;
      &lt;td&gt;Content-type: text/pain&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt; &lt;/td&gt;
      &lt;td&gt;Content-length: 19&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;主体&lt;/td&gt;
      &lt;td&gt;Hi! I’m a message!&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;说明&lt;/code&gt;起始行和首部就是由行分隔的ASCII文本，每行都以一个由两个字符组成的行终止序列作为结束，其中包括一个回车符(ASCII 13)和一个换行符(ASCII 10)，这个行终止序列可以写作CRLF；主体部分是可选的，可以是文本或包含二进制数据，也可以为空。&lt;/p&gt;

&lt;h5 id=&quot;section-2&quot;&gt;报文的语法&lt;/h5&gt;
&lt;p&gt;报文分为两类:请求报文，响应报文，通常的请求报文格式是:&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;nt&quot;&gt;&amp;lt;method&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;request-URL&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;headers&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;entity-body&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;响应报文格式:&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;nt&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;status&amp;gt;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;reason-phrase&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;headers&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;entity-body&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;简要描述&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;method: 客户端希望对服务器资源执行的动作。比如GET/HEAD/POST/PUT，后面会有详解。&lt;/li&gt;
  &lt;li&gt;request-URL: 请求资源的完整URL&lt;/li&gt;
  &lt;li&gt;version: HTTP 版本 &lt;code class=&quot;highlighter-rouge&quot;&gt;HTTP/&amp;lt;major&amp;gt;.&amp;lt;minor&amp;gt;&lt;/code&gt; major:主要版本号，minor:次要版本号，都是整数。&lt;/li&gt;
  &lt;li&gt;status: 三位数字描述请求过程中所发生的情况。&lt;/li&gt;
  &lt;li&gt;reason-phrase: 原因短语，是开发人员定义的，比如200，定义reason-phrase : NOT OK。&lt;/li&gt;
  &lt;li&gt;header: 可以有零个或多个首部，每个首部都包含一个名字后面是(:)然后是可选的空格，接着是值，最后是一个CRLF。&lt;/li&gt;
  &lt;li&gt;entity-body: 可选，包含一个由任意数据块组成的数据块。有时，报文只是以一个CRLF结束。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;⚠️一组HTTP首部总是应该以CRLF结束，但由于历史原因，很多客户端和服务器在实现主体部分时，都(错误地)省略了最后的CRLF，为了这些流行但不符合规则的实现进行互通，客户端和服务器端都应该接受那些最后没有CRLF的报文。&lt;/p&gt;

&lt;h5 id=&quot;section-3&quot;&gt;起始行&lt;/h5&gt;
&lt;ol&gt;
  &lt;li&gt;请求行&lt;/li&gt;
  &lt;li&gt;响应行&lt;/li&gt;
  &lt;li&gt;方法 GET/HEAD/POST/PUT/TRACE/OPTIONS/DELETE&lt;/li&gt;
  &lt;li&gt;状态码 1XX/2XX/3XX/4XX/5XX&lt;/li&gt;
  &lt;li&gt;原因短语 对状态码提供的文本形式解释&lt;/li&gt;
  &lt;li&gt;版本号 HTTP/x.y&lt;/li&gt;
&lt;/ol&gt;

&lt;h5 id=&quot;section-4&quot;&gt;首部&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;通用首部 既可以在请求报文中也可以在响应报文中&lt;/li&gt;
  &lt;li&gt;请求首部 提供更多有关请求的信息&lt;/li&gt;
  &lt;li&gt;响应首部 提供更多有关响应的信息&lt;/li&gt;
  &lt;li&gt;实体首部 描述主体的长度和内容，或者资源本身&lt;/li&gt;
  &lt;li&gt;扩展首部 规范中没有定义的新首部&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;⚠️每个HTTP首部都有个一个简单的语法: 名字后面跟”:”然后是可选空格再跟字段值，最后是一个CRLF，比如Content-length: 12334 , Content-type: image/gif , …..等
首部行分为多行可提高可读性，多出来的每行前面至少要有一个空格或制表符(tab).&lt;/p&gt;

&lt;h5 id=&quot;section-5&quot;&gt;实体的主体部分&lt;/h5&gt;

&lt;p&gt;主体部分就是要传输的内容可承载很多类型的数字数据:图片、视频、HTML文档、软件应用程序、电子邮件等。&lt;/p&gt;

&lt;h5 id=&quot;section-6&quot;&gt;版本0.9的报文&lt;/h5&gt;

&lt;p&gt;HTTP/0.9报文也是由请求和响应组成，但请求中只包含方法和请求URL，响应中只包含实体。没有版本信息(它是第一个，也是当时唯一的版本)，没有状态码或者原因短语，也没有首部。&lt;/p&gt;

&lt;h4 id=&quot;section-7&quot;&gt;方法&lt;/h4&gt;

&lt;p&gt;HTTP定义不产生动作的方法为安全方法，即不会在服务器端产生任何结果，反之不安全。
幂等指的是，请求若干次和请求一次的结果一致，反之非幂等。
&lt;a href=&quot;https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Safe_methods&quot;&gt;详情&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;GET 安全幂等&lt;/li&gt;
  &lt;li&gt;HEAD 安全幂等,响应只返回首部&lt;/li&gt;
  &lt;li&gt;PUT 向服务器写入文档，服务器根据请求URL来命名新文档，如果那个URL已经存在文档，则用当前请求的主体来替代它，因为PUT允许用户对内容进行修改，所以一般Web服务器都需要在执行PUT之前，用密码登陆。不安全，幂等。&lt;/li&gt;
  &lt;li&gt;POST 不安全，不幂等&lt;/li&gt;
  &lt;li&gt;TRACE 安全幂等&lt;/li&gt;
  &lt;li&gt;OPTIONS 请求Web服务器告知其支持的各种功能 安全幂等&lt;/li&gt;
  &lt;li&gt;DELETE 请求Web服务器删除请求URL所指定的资源 不安全幂等&lt;/li&gt;
  &lt;li&gt;扩展方法&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;section-8&quot;&gt;状态码&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;100 ~ 199 信息性状态码
    &lt;blockquote&gt;
      &lt;ul&gt;
        &lt;li&gt;100 Continue 说明收到了请求的初始部分，请客户端继续，发送了这个状态码之后服务器在收到请求之后必须进行响应。&lt;/li&gt;
        &lt;li&gt;101 Switching Protocols 服务器根据客户端的指定，将协议切换成Update首部所列的协议。&lt;/li&gt;
      &lt;/ul&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;200 ~ 299 成功状态码&lt;/li&gt;
&lt;/ul&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;200 OK&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;201 Created&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;202 Accepted&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;203 Non-Authoritative&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;204 No Content&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;205 Reset Content&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;206 Partial Content&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;ul&gt;
  &lt;li&gt;300 ~ 399 重定向状态码&lt;/li&gt;
&lt;/ul&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;300 Multiple Choices&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;301 Moved Permanently&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;302 Found; 303 See Other&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;304 Not Modified&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;305 Use Proxy&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;306 未使用&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;307 Temporary Redirect&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;⚠️ 302、303、307存在交叉，跟HTTP版本有关系1.0/1.1&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;400 ~ 499 客户端❌状态码&lt;/li&gt;
&lt;/ul&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;400 Bad Request&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;401 Unauthorized&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;402 PaymentRequired&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;403 Forbidden&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;404 Not Found&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;405 Method Not Allowed&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;406 Not Acceptable&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;407 Proxy Authentication Required&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;408 Request Timeout&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;409 Conflict&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;410 Gone 与404类似,只是服务器曾经拥有该请求资源&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;411 Length Required&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;412 Precondition Failed&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;413 Request Entity Too Large&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;414 Request URI Too Long&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;415 Unsupported Media Type&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;416 Requested Range Not Satisfiable&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;417 Expectation Failed 请求首部包含Expect值但服务器无法满足时返回此状态码&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;ul&gt;
  &lt;li&gt;500 ~ 599 服务器❌状态码&lt;/li&gt;
&lt;/ul&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;500 Internal Server Error&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;501 Not Implemented&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;502 Bad GateWay&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;503 Service Unabailable&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;504 Gateway Timeout 与408类似&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;505 HTTP Version Not Supported&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h5 id=&quot;section-9&quot;&gt;首部&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;通用首部&lt;/li&gt;
&lt;/ul&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;首部&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;描述&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Connection&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;允许客户端与服务器指定与请求/响应连接有关的选项&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Date&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;日期和时间标志，说明报文是何时创建的&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;MIME-Version&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;给出发出端使用的MIME版本&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Trailer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;如果报文采用分块传输编码方式,就可以用这个首部列出位于报文拖挂(trailer)部分的首部集合&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Transfer-Encoding&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;告知接收端为保证报文的可靠传输,对报文采用了什么编码方式&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Update&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;给出发送端可能想要升级使用的新版本或协议&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Via&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;显示报文经过的中间节点(代理、网关)&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;通用缓存首部&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Cache-Control&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;用于报文传送缓存指示&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Pragma&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;另一种随报文传送指示的方式,但并不专用于缓存&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;ul&gt;
  &lt;li&gt;请求首部&lt;/li&gt;
&lt;/ul&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;首部&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;描述&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Client_IP&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;客户端机器IP&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;From&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;客户端使用的E-mail地址&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Host&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;接收请求的服务器主机号和端口号&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Referer&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;包含当前请求URI的文档的URL&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;UA-Color&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;客户端显示器的颜色有关信息&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;UA-CPU&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;客户端CPU类型或制造商&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;UA-Disp&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;客户端显示器信息&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;UA-OS&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;客户端操作系统&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;UA-Pixels&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;客户端像素信息&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;UA-Agent&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;发起请求的应用程序名称告知服务器&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;ol&gt;
  &lt;li&gt;Acctpt首部(Accept,Accept-Charset,Accept-Encoding,Accept-Language,TE&lt;code class=&quot;highlighter-rouge&quot;&gt;告知服务器可以使用哪些扩展传输编码&lt;/code&gt;)&lt;/li&gt;
  &lt;li&gt;条件请求首部(Expect,If-Match,If-Modified-Since,If-None-Match,If-Range,If-Unmodified-Since,Range)&lt;/li&gt;
  &lt;li&gt;安全请求首部(Authorization,Cookie,Cookie2)&lt;/li&gt;
  &lt;li&gt;代理请求首部(Max-Forward&lt;code class=&quot;highlighter-rouge&quot;&gt;与TRACE一同使用&lt;/code&gt;,Proxy-Authorization,Proxy-Connection)&lt;/li&gt;
&lt;/ol&gt;

&lt;ul&gt;
  &lt;li&gt;响应首部 Server: Tiki-Hut/1.0&lt;/li&gt;
&lt;/ul&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;首部&lt;/th&gt;
      &lt;th&gt;描述&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Age&lt;/td&gt;
      &lt;td&gt;从创建开始，响应持续时间&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Public&lt;/td&gt;
      &lt;td&gt;服务器为其资源支持的请求方法列表&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Retry-After&lt;/td&gt;
      &lt;td&gt;如果资源不存在，在此日期或时间重试&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Server&lt;/td&gt;
      &lt;td&gt;服务器软件的名称和版本&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Title&lt;/td&gt;
      &lt;td&gt;对HTML来说就是HTML文档的源端给出的标题&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Warning&lt;/td&gt;
      &lt;td&gt;比原因短语中更详细一些的警告报文&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;ol&gt;
  &lt;li&gt;协商首部(Accept-Ranges:对此资源来说，服务器可以接受的范围类型.Vary:服务器查看的其他首部列表)&lt;/li&gt;
  &lt;li&gt;安全响应首部(与安全请求首部对应,Proxy-Authenticate,Set-Cookie,Set-Cookie2,WWW-Authenticate来自服务器的对客户端的质询列表)&lt;/li&gt;
&lt;/ol&gt;

&lt;ul&gt;
  &lt;li&gt;实体首部 Content-Type: text/html; charset=iso-latin-1&lt;/li&gt;
&lt;/ul&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;首部&lt;/th&gt;
      &lt;th&gt;描述&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;Allow&lt;/td&gt;
      &lt;td&gt;列出可以对此实体执行对请求方法&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Location&lt;/td&gt;
      &lt;td&gt;实体资源的URL&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;ol&gt;
  &lt;li&gt;内容首部(Content-Base,Content-Encoding,Content-Language,Content-Length,Content-Location,Content-MD5,Content-Range,Content-Type)&lt;/li&gt;
  &lt;li&gt;实体缓存首部(ETag:与此实体相关的实体标记,Expires:实体不在有效，要从源端再次获取此实体的日期和时间，Last-Modified:实体最后一次被修改的日期和时间)&lt;/li&gt;
&lt;/ol&gt;

&lt;ul&gt;
  &lt;li&gt;扩展首部 非标准首部，开发者自己创建&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;⚠️HTTP规范允许服务器在不通知客户端的情况下撤销请求&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Summary_table&quot;&gt;Wiki HTTP Method&lt;/a&gt;
&lt;a href=&quot;http://www.w3.org/Protocols/&quot;&gt;HTTP的W3C架构页&lt;/a&gt;&lt;/p&gt;</content><author><name>michael</name></author><category term="CS" /><summary>HTTP报文</summary></entry><entry><title>黑客与画家-读书笔记</title><link href="/cs/2016/09/25/%E9%BB%91%E5%AE%A2%E4%B8%8E%E7%94%BB%E5%AE%B6%E7%AC%94%E8%AE%B0.html" rel="alternate" type="text/html" title="黑客与画家-读书笔记" /><published>2016-09-25T00:00:00+08:00</published><updated>2016-09-25T00:00:00+08:00</updated><id>/cs/2016/09/25/黑客与画家笔记</id><content type="html" xml:base="/cs/2016/09/25/%E9%BB%91%E5%AE%A2%E4%B8%8E%E7%94%BB%E5%AE%B6%E7%AC%94%E8%AE%B0.html">&lt;p&gt;这是一本13年读过的书，时至今日已过去近3年，古人说&lt;code class=&quot;highlighter-rouge&quot;&gt;温故而知新&lt;/code&gt;，虽然中间的间隔比较久，由于最近在学Clojure，而它是一个Lisp方言，而我第一次接触的Lisp就是黑客与画家，如今在此捧起这本书，为的是去思考去发现其中的精髓。&lt;/p&gt;

&lt;p&gt;保罗•格雷厄姆创业哲学，他的创业公式是:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;搭建原型&lt;/li&gt;
  &lt;li&gt;上线运营(别管bug)&lt;/li&gt;
  &lt;li&gt;收集反馈&lt;/li&gt;
  &lt;li&gt;调整产品&lt;/li&gt;
  &lt;li&gt;成长壮大&lt;/li&gt;
&lt;/ol&gt;

&lt;ul&gt;
  &lt;li&gt;创业时创始人数控制在2～3人&lt;/li&gt;
  &lt;li&gt;出于兴趣而解决某个难题，不管它有没有用，这就是黑客&lt;/li&gt;
  &lt;li&gt;黑客三个特性:&lt;code class=&quot;highlighter-rouge&quot;&gt;好玩&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;高智商&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;探索精神&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h6 id=&quot;section&quot;&gt;黑客伦理&lt;/h6&gt;

&lt;ol&gt;
  &lt;li&gt;使用计算机以及所有有助于了解这个世界本质的事务都不应接到任何限制，任何事情都应亲手尝试。&lt;/li&gt;
  &lt;li&gt;所有信息应该都是自由的。&lt;/li&gt;
  &lt;li&gt;不信任权威，提倡去中心化。&lt;/li&gt;
  &lt;li&gt;判断一名黑客的水平应该看他的技术水平，而不是看他的学历、年龄或地位等其他标准。&lt;/li&gt;
  &lt;li&gt;你可以用计算机创造美和艺术。&lt;/li&gt;
  &lt;li&gt;计算机使生活更美好。&lt;/li&gt;
&lt;/ol&gt;

&lt;blockquote&gt;
  &lt;p&gt;总结:分享、开放、民主、计算机的自由使、进步&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h5 id=&quot;section-1&quot;&gt;第十章:编程语言解析&lt;/h5&gt;

&lt;ul&gt;
  &lt;li&gt;证明编程语言的一个重要特点:一个操作所需的代码越多，就越难避免bug，也越难发现它们。&lt;/li&gt;
&lt;/ul&gt;</content><category term="CS" /><summary>黑客与画家读书笔记</summary></entry><entry><title>高性能mysql读书笔记</title><link href="/mysql/2016/09/25/%E9%AB%98%E6%80%A7%E8%83%BDmysql-4.html" rel="alternate" type="text/html" title="高性能mysql读书笔记" /><published>2016-09-25T00:00:00+08:00</published><updated>2016-09-25T00:00:00+08:00</updated><id>/mysql/2016/09/25/高性能mysql-4</id><content type="html" xml:base="/mysql/2016/09/25/%E9%AB%98%E6%80%A7%E8%83%BDmysql-4.html">&lt;h3 id=&quot;schema&quot;&gt;Schema与数据类型优化&lt;/h3&gt;

&lt;h5 id=&quot;section&quot;&gt;数据库的设计军规&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;更小的通常更好&lt;/li&gt;
  &lt;li&gt;简单就好&lt;/li&gt;
  &lt;li&gt;尽量避免&lt;code class=&quot;highlighter-rouge&quot;&gt;NULL&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;ol&gt;
  &lt;li&gt;整数类型:&lt;code class=&quot;highlighter-rouge&quot;&gt;TINYINT&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;SMALLINT&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;MEDIUMINT&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;INT&lt;/code&gt; &lt;code class=&quot;highlighter-rouge&quot;&gt;BIGINT&lt;/code&gt;分别使用8，16，24，32，64位存储空间。它们可以存储的值的范围从-2^(N-1) 到-2^(N-1) - 1，其中N是存储空间的位数。有可选的&lt;code class=&quot;highlighter-rouge&quot;&gt;UNSIGNED&lt;/code&gt;属性，表示不允许负值，例如:&lt;code class=&quot;highlighter-rouge&quot;&gt;UNSIGNED&lt;/code&gt;可以存储的范围是0 ~ 255,而&lt;code class=&quot;highlighter-rouge&quot;&gt;TINYINT&lt;/code&gt;的存储范围是-128 ~ 127。&lt;/li&gt;
  &lt;li&gt;实数类型:指带有小数部分的数字。对于&lt;code class=&quot;highlighter-rouge&quot;&gt;DECIMAL&lt;/code&gt;列，可以指定小数点前后所允许的最大位数，这会影响列的空间消耗。MySQL 5.0和更高的版本将数字打包保存到一个二进制字符串中(每4格字节存储9格数字)。例如: &lt;code class=&quot;highlighter-rouge&quot;&gt;DECIMAL(18,9)&lt;/code&gt;小数点两边将个存储9格数字，一共使用9格字节，小数点前后各4各字节，小数点本身占用一个字节。浮点类型在存储同样范围的值时，通常比&lt;code class=&quot;highlighter-rouge&quot;&gt;DECIMAL&lt;/code&gt;使用更少的空间。&lt;code class=&quot;highlighter-rouge&quot;&gt;FLOAT&lt;/code&gt;使用4个字节存储，&lt;code class=&quot;highlighter-rouge&quot;&gt;DOUBLE&lt;/code&gt;占用8个字节，相比&lt;code class=&quot;highlighter-rouge&quot;&gt;FLOAT&lt;/code&gt;有更高的精度和更大的范围，&lt;code class=&quot;highlighter-rouge&quot;&gt;MySQL&lt;/code&gt;使用&lt;code class=&quot;highlighter-rouge&quot;&gt;DOUBLE&lt;/code&gt;作为内部浮点计算的类型。因为需要额外的空间和计算开销，所以应该尽量只在对小数进行精确计算时才使用&lt;code class=&quot;highlighter-rouge&quot;&gt;DECIMAL&lt;/code&gt;，例如存储财务数据，但在数据量比较大的时候，可以考虑使用&lt;code class=&quot;highlighter-rouge&quot;&gt;BIGINT&lt;/code&gt;代替&lt;code class=&quot;highlighter-rouge&quot;&gt;DECIMAL&lt;/code&gt;，将需要存储的值乘以小数点后面相应的倍数即可，这样同时避免浮点存储计算的不精确和&lt;code class=&quot;highlighter-rouge&quot;&gt;DECIMAL&lt;/code&gt;精确计算代价高的问题。&lt;/li&gt;
  &lt;li&gt;字符串。&lt;/li&gt;
&lt;/ol&gt;</content><category term="MySQL" /><summary>第四章</summary></entry></feed>
