<!DOCTYPE html>
<html>
  <head>
    <title>大型网站系统与Java中间件实践 – Michael – Developer</title>

        <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>

    
    <meta name="description" content="WebSystemJavaMiddlewarePractice" />
    <meta property="og:description" content="WebSystemJavaMiddlewarePractice" />
    
    <meta name="author" content="Michael" />

    
    <meta property="og:title" content="大型网站系统与Java中间件实践" />
    <meta property="twitter:title" content="大型网站系统与Java中间件实践" />
    

    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="alternate" type="application/rss+xml" title="Michael - Developer" href="/feed.xml" />
    <link rel="shortcut icon" href="/images/favicon.ico" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css"/>
  </head>

  <body>

    <div class="wrapper-masthead">
      <div class="container">
        <header class="masthead clearfix">
          <a href="/" class="site-avatar"><img src="/images/favicon.ico" /></a>

          <div class="site-info">
            <h1 class="site-name"><a href="/">Michael</a></h1>
            <p class="site-description">Developer</p>
          </div>

          <nav>
            <a href="/"><i class="fa fa-home fa-2x"></i></a>
            <a href="/category"><i class="fa fa-tags fa-2x" aria-hidden="true"></i></a>
            <a href="/about"><i class="fa fa-user-secret fa-2x"></i></a>
            <a href="/blog"><i class="fa fa-university fa-2x"></i></a>
            <!-- <a href="/task"><i class="fa fa-book fa-2x" aria-hidden="true"></i></a> -->
            <a href="/feed.xml" target="_blank"><i class="fa fa-feed fa-2x"></i></a>

            <!-- 
            
              
            
              
            
              
              <a href="/" >
                Home
              </a>
              
            
              
              <a href="/blog" >
                Blog
              </a>
              
            
              
              <a href="/category" >
                Category
              </a>
              
             -->
          </nav>

          <a href="https://github.com/MichaelYgZhang" target="_blank">
            <img class="fork-me-on-github" src="/images/fork-me-on-github.png" alt="Fork me on GitHub">
          </a>
        </header>

        <div id="search-container">
          <input type="text" id="search-input" placeholder="search...">
          <ul id="results-container"></ul>
        </div>

      </div>
    </div>

    <div id="main" role="main" class="container">
      <article class="post">
  <div class="post">
    <h1 class="post-title">大型网站系统与Java中间件实践</h1>
    <span class="post-date">2017-01-03</span>
    <!--  |
    
     -->
    <article>
      <h5 id="第一章-分布式系统介绍">第一章 分布式系统介绍</h5>

<ul>
  <li>A distributed system is one in which components located at networked computers communicate and
coordinate their actions only by passing messages。 分布式系统的定义。一，组件分布在网络计算机中，二是组件之间
仅仅通过消息传递来通信并协调行动。</li>
  <li>组成计算机的基本元素包括输入设备、输出设备、运算器、控制器、存储器。存储器又分为内存和外存。</li>
  <li>对于线程不安全的容器或对象可以通过加锁或者通过<code class="highlighter-rouge">Copy On Write</code>的方式控制并发访问。</li>
  <li>分布式系统的难点：
    <ol>
      <li>缺乏全局时钟</li>
      <li>面对故障独立性</li>
      <li>处理单点故障
        <ul>
          <li>单点变集群</li>
          <li>给这个单点做好备份，能够在出现问题时进行恢复，并且尽量做到自动恢复，降低恢复需要用的时间。</li>
          <li>降低单点故障的影响范围。</li>
        </ul>
      </li>
      <li>事务的挑战</li>
    </ol>
  </li>
</ul>

<h5 id="第二章-大型网站及其架构演进过程">第二章 大型网站及其架构演进过程</h5>
<ul>
  <li>分</li>
  <li>session问题
    <ol>
      <li>Session Sticky</li>
      <li>Session Replication</li>
      <li>Session数据集中存储</li>
      <li>Cookie Based，长度限制，安全性问题，带宽消耗，性能影响</li>
    </ol>
  </li>
  <li>数据库读写压力变大，读写分离
    <ul>
      <li>数据复制问题，会出现数据一致性延迟问题</li>
      <li>应用对于数据源的选择问题</li>
      <li>加速数据读取的利器–缓存</li>
    </ul>
  </li>
  <li>页面缓存</li>
  <li>分布式存储系统</li>
  <li>库的水平／垂直 拆分</li>
  <li>数据库拆分的问题
    <ol>
      <li>分布式事务问题</li>
      <li>分页查询问题</li>
    </ol>
  </li>
  <li>走服务化的路</li>
  <li>初识消息中间件
    <ol>
      <li>MOM(Message-oriented middleware) is software infrastructure focused on sending and receiving
  message between distributed systems</li>
      <li>异步和解耦</li>
    </ol>
  </li>
</ul>

<h5 id="第三章-构件java中间件">第三章 构件Java中间件</h5>

<ul>
  <li>远程过程调用和对象访问中间件；主要解决分布式环境下应用的互相访问问题，支撑服务化的基础。</li>
  <li>消息中间件，解决应用之间的消息传递、解耦、异步的问题。</li>
  <li>数据访问中间件，主要解决应用访问数据库的共性翁题的组件。</li>
</ul>

<h5 id="第四章-服务框架">第四章 服务框架</h5>

<ul>
  <li>服务的拆分</li>
  <li>服务的粒度</li>
  <li>优雅和实用的平衡</li>
  <li>分布式环境中的请求合并</li>
  <li>分布式锁服务，看情况是否可以根据一定规则把同样的请求分配到同一台服务器上，这样避免了分布式锁的复杂度。</li>
  <li>ESB总线模型，可以更多考虑不同厂商所提供服务的整合。</li>
</ul>

<h5 id="第五章-数据访问层">第五章 数据访问层</h5>

<ul>
  <li>分布式事务；X/Open: Application Program, Resource Manager, Transaction Manager</li>
  <li>CAP (Consistency, Availability, Partition-Tolerance)</li>
  <li>BASE (Basically Available, Soft state, Eventually consistent)</li>
  <li>一般选择CAP中的A和P对于C策略就是保证最终一致性</li>
  <li>Paxos协议：少数服从多数原则</li>
  <li>集群内数据一致性的算法
    <ol>
      <li>Quorum,用来权衡分布式系统中数据一致性和可用性</li>
      <li>补偿重试机制</li>
    </ol>
  </li>
  <li>多机器的Sequence问题与处理
    <ol>
      <li>唯一性</li>
      <li>连续性
        <ul>
          <li>ID集中管理问题：1 性能问题  2 生成器的稳定性问题 3 存储问题</li>
        </ul>
      </li>
    </ol>
  </li>
  <li>分布式查询问题
    <ol>
      <li>跨库join问题，在服务层分多次查询数据库或者数据冗余，借助外部系统比如搜索引擎解决一些跨库问题。</li>
      <li>外键约束。</li>
    </ol>
  </li>
  <li>SQL解析–&gt;规则处理–&gt;SQL改写–&gt;数据源选择–&gt;SQL执行–&gt;结果集返回合并处理</li>
  <li>读写分离，主/备库分库方式不同的数据复制，非对称复制，引入数据变更平台</li>
  <li>数据平滑迁移，添加增量日志</li>
</ul>

<h5 id="第六层-消息中间件">第六层 消息中间件</h5>

<ul>
  <li>MOM(Message-oriented middleware)</li>
  <li>如何确定消息发送一致性</li>
  <li>JMS
    <ol>
      <li>Destination, 指消息所走通道的目标定义，也就是用来定义消息从发送端发出后要走的通道，而不是最终接收方，它属于管理类的对象。</li>
      <li>ConnectionFactory，指用于创建连接的对象，属于管理类的对象。</li>
      <li>Connnection，连接接口，所负责的重要工作是创建Session</li>
      <li>Seesion，会话接口，消息的发送者，接收者以及消息对象本身，都是由这个会话对象创建的。</li>
      <li>MessageConsumer，消息的消费者，订阅消息并处理消息的对象</li>
      <li>MessageProducer，消息的生产者，用来发送消息的对象</li>
      <li>XXXMessage，指各种类型的消息对象，包括BytesMessage、MapMessage、ObjectMessage、StreamMessage和TextMessage 5种。</li>
      <li>XA系列接口为了实现分布式事务的支持</li>
    </ol>
  </li>
  <li>解决一致性的方案
    <ol>
      <li>发送消息给消息中间件</li>
      <li>消息中间件入库消息</li>
      <li>消息中间件返回结果</li>
      <li>业务操作</li>
      <li>发送业务操作结果给消息中间件</li>
      <li>更改存储中消息状态</li>
    </ol>
  </li>
</ul>

<div class="language-java highlighter-rouge"><pre class="highlighter"><code><span class="c1">//伪代码</span>
<span class="n">Result</span> <span class="nf">postMessage</span><span class="o">(</span><span class="n">Message</span> <span class="n">m</span><span class="o">,</span> <span class="n">PostMessageCallback</span> <span class="n">pmc</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">//发送消息给消息中间件</span>
  <span class="c1">//获取返回结果</span>
  <span class="c1">//如果失败，返回失败</span>
  <span class="c1">//进行业务操作</span>
  <span class="c1">//获取业务操作结果</span>
  <span class="c1">//发送业务操作结果给消息中间件</span>
  <span class="c1">//返回处理结果</span>
<span class="o">}</span>
</code></pre>
</div>

<ul>
  <li>解决消息中间件与使用者的强依赖问题
    <ol>
      <li>提供消息中间件系统的可靠性，但没办法保证百分百可靠。</li>
      <li>对于消息中间件系统中影响业务操作进行的部分，使其可靠性与业务自身的可靠性相同。</li>
      <li>可以提供弱依赖的支持，能够较好地保证一致性。</li>
    </ol>
  </li>
  <li>消息模型对消息接收的影响
    <ol>
      <li>JMS Queue模型 只有一个应用会去消费某一条消息，所以JMS Queue模型也被称为PeerToPeer(PTP)方式</li>
      <li>JMS Topic模型 可以独立收到所有到达Topic的消息，所以也被称为Pub/Sub方式</li>
    </ol>
  </li>
  <li>消息订阅者订阅消息方式
    <ol>
      <li>持久订阅和非持久订阅。</li>
    </ol>
  </li>
  <li>消息系统的扩容处理，给每一条消息增加一个server标识字段，当有新加入的消息中间件时，会使用新的server标识。</li>
  <li>消息存储的扩容处理，？</li>
  <li>应对消息重复的办法时，使消息接收端的处理是一个幂等操作，这样做降低了消息中间件的整体复杂度，同时给消息中间件
接收端应用带来一定的限制和门槛。</li>
  <li>保证顺序的消息队列设计</li>
  <li>消息中间件Push和Pull方式</li>
</ul>

<h5 id="第七章-软负载中心与集中配置管理">第七章 软负载中心与集中配置管理</h5>

<ul>
  <li>软负载中心基础职责。聚合地址信息，生命周期感知。</li>
  <li></li>
</ul>

<h5 id="第八章-构建大型网站的其他要素">第八章 构建大型网站的其他要素</h5>

    </article>
  </div>

  <div class="related">
    <h4>最新文章</h4>
    <ul class="related-posts">
      
        <li>
          <h5>
            <a href="/architecture/2017/08/10/%E4%BA%BF%E7%BA%A7%E6%B5%81%E9%87%8F%E7%BD%91%E7%AB%99%E6%9E%B6%E6%9E%84%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF.html">
              亿级流量网站架构核心技术
              <small>2017-08-10</small>
            </a>
          </h5>
        </li>
      
        <li>
          <h5>
            <a href="/architecture/2017/07/26/%E9%87%8D%E6%9E%84%E6%94%B9%E5%96%84%E6%97%A2%E6%9C%89%E4%BB%A3%E7%A0%81%E7%9A%84%E8%AE%BE%E8%AE%A1.html">
              重构-改善既有代码的设计
              <small>2017-07-26</small>
            </a>
          </h5>
        </li>
      
        <li>
          <h5>
            <a href="/books/2017/07/07/%E4%BA%B2%E5%AF%86%E5%85%B3%E7%B3%BB.html">
              亲密关系
              <small>2017-07-07</small>
            </a>
          </h5>
        </li>
      
    </ul>
  </div>

  
<div class="comments">
	<div id="disqus_thread"></div>
	<script type="text/javascript">

	    var disqus_shortname = 'michaelygzhangblog';

	    (function() {
	        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	    })();

	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

</article>

    </div>

    <div class="wrapper-footer">
      <div class="container">
        <footer class="footer">
          
<a href="mailto:g.zhangyg@gmail.com"><i class="svg-icon email"></i></a>


<a href="https://github.com/MichaelYgZhang"><i class="svg-icon github"></i></a>




<a href="https://www.twitter.com/michaelygzhang"><i class="svg-icon twitter"></i></a>


<a href="https://plus.google.com/115646538142388831563"><i class="svg-icon googleplus"></i></a>

        </footer>
      </div>
    </div>

    <div id="backToTop" class="backtoTop">
    	<i class="fa fa-hand-o-up fa-2x"></i>
    </div>

    
	<!-- Google Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-84531968-1', 'auto');
		ga('send', 'pageview', {
		  'page': '/java/2017/01/03/web-system-java-middleware.html',
		  'title': '大型网站系统与Java中间件实践'
		});
	</script>
	<!-- End Google Analytics -->


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/simple-jekyll-search/1.1.5/jekyll-search.js" type="text/javascript"></script>
    <script src="/js/blog.js" type="text/javascript"></script>

    <script type="text/javascript">
          SimpleJekyllSearch({
            searchInput: document.getElementById('search-input'),
            resultsContainer: document.getElementById('results-container'),
            json: '/search.json',
            searchResultTemplate: '<li><a href="{url}" title="{desc}">{title}</a></li>',
            noResultsText: 'No results found',
            limit: 10,
            fuzzy: false,
            exclude: ['Welcome']
          })
    </script>
  </body>
</html>
